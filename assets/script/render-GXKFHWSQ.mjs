import{a as ed}from"https://app.framerstatic.com/chunk-PX3HOEIE.mjs";import"https://app.framerstatic.com/chunk-CI47YF3H.mjs";import{a as st}from"https://app.framerstatic.com/chunk-NVJNG57P.mjs";import{a as Jl}from"https://app.framerstatic.com/chunk-VYDUMP4T.mjs";import{a as Ql,b as Un}from"https://app.framerstatic.com/chunk-NRTGVP6E.mjs";import"https://app.framerstatic.com/chunk-CA5SZ7OZ.mjs";import"https://app.framerstatic.com/chunk-GFEWXSB2.mjs";import{$ as Al,Ba as Ml,D as xl,Ea as Qt,Fa as Ll,H as Pl,I as gn,J as vl,Ja as Vl,K as Fl,L as bl,N as hn,Oa as zl,Pa as Wl,Qa as Hl,Ra as jl,Ta as _l,Ua as Kl,Xa as ql,Y as Sl,Ya as Gl,Z as El,Za as gr,_ as Tl,aa as Dl,ab as H,ba as Rl,cb as Yl,db as $l,fa as ur,fb as hr,gb as Xl,hb as Zl,na as xo,oa as Bl,p as A,q as Dt,qa as kl,r as P,ra as yn,s as yl,sa as Ol,t as Il,xa as Po,za as In}from"https://app.framerstatic.com/chunk-HZYYADKQ.mjs";import"https://app.framerstatic.com/chunk-4QFGU5QZ.mjs";import{Ia as pl,Ma as ul,Qa as gl,Sa as hl,Y as mr,e as un,qa as ml}from"https://app.framerstatic.com/chunk-B4CLU4MT.mjs";import"https://app.framerstatic.com/chunk-Y5CX2PAH.mjs";import{A as Qs,C as el,D as tl,I as sr,J as ol,K as lr,M as dr,N as cr,O as rl,Q as nl,S as il,T as al,U as sl,V as at,X as fr,a as Ws,c as js,d as _s,l as Xs,x as Zs,y as Js}from"https://app.framerstatic.com/chunk-E7LXH444.mjs";import"https://app.framerstatic.com/chunk-XBQWQOWZ.mjs";import"https://app.framerstatic.com/chunk-MAOAHTTI.mjs";import"https://app.framerstatic.com/chunk-7HB5VG25.mjs";import{J as Os}from"https://app.framerstatic.com/chunk-CZBECBU3.mjs";import{a as it,d as Ms}from"https://app.framerstatic.com/chunk-UPX72TN4.mjs";import{$ as Us,E as ds,Ha as Es,I as cs,J as fs,O as Ct,P as xt,R as M,U as ms,V as gs,W as hs,Wa as As,X as or,Y as rr,Z as ys,_ as Is,aa as Zt,ca as nr,da as ir,jb as Rs,lb as Vs,pa as Cs,wa as xs}from"https://app.framerstatic.com/chunk-LMQ3TSER.mjs";import{P as Bs,Q as ks,S as Ls,V as zs,g as Fs,o as bs,t as Ss}from"https://app.framerstatic.com/chunk-WFGIIT3T.mjs";import{Q as ws}from"https://app.framerstatic.com/chunk-RLZCRYI7.mjs";import{Bf as Xt,Gf as as,If as ss,Jf as ls,Kf as Co,Mf as wt,ae as os,ca as va,cf as ns,dd as Jo,fa as Fa,fd as ts,kf as is,la as C,ma as ba,uf as tr}from"https://app.framerstatic.com/chunk-7NFS6WJI.mjs";import{i as rs}from"https://app.framerstatic.com/chunk-MST52DSH.mjs";import"https://app.framerstatic.com/chunk-TREJZ2CI.mjs";import{i as ps,j as us}from"https://app.framerstatic.com/chunk-YE4QPCYK.mjs";import"https://app.framerstatic.com/chunk-EDICM4ZE.mjs";import"https://app.framerstatic.com/chunk-MTT6DWBN.mjs";import"https://app.framerstatic.com/chunk-5C7X4FEK.mjs";import"https://app.framerstatic.com/chunk-Z2EPYIAC.mjs";import"https://app.framerstatic.com/chunk-N57XNHE3.mjs";import"https://app.framerstatic.com/chunk-DA6RNBSL.mjs";import"https://app.framerstatic.com/chunk-HWNIP5RG.mjs";import"https://app.framerstatic.com/chunk-V74VFLF3.mjs";import"https://app.framerstatic.com/chunk-5UBXWMHU.mjs";import{f as Nl}from"https://app.framerstatic.com/chunk-7TMIIOSL.mjs";import"https://app.framerstatic.com/chunk-BXMRPHVL.mjs";import{a as cl,b as fl}from"https://app.framerstatic.com/chunk-RXAXOTBX.mjs";import"https://app.framerstatic.com/chunk-5OIIBPVR.mjs";import{a as ar}from"https://app.framerstatic.com/chunk-5NS6QBV7.mjs";import"https://app.framerstatic.com/chunk-RWUR3M2X.mjs";import"https://app.framerstatic.com/chunk-N6YWBNWS.mjs";import"https://app.framerstatic.com/chunk-3YLVAZ7K.mjs";import"https://app.framerstatic.com/chunk-IFXNPZYF.mjs";import"https://app.framerstatic.com/chunk-3QRSBZ5D.mjs";import"https://app.framerstatic.com/chunk-67PXYNDJ.mjs";import"https://app.framerstatic.com/chunk-XRF57DXY.mjs";import"https://app.framerstatic.com/chunk-WDVSG56F.mjs";import{a as Jt}from"https://app.framerstatic.com/chunk-DYWDHJIE.mjs";import"https://app.framerstatic.com/chunk-V3C5CSFI.mjs";import"https://app.framerstatic.com/chunk-FUQZY6JN.mjs";import"https://app.framerstatic.com/chunk-IXOQ7SRR.mjs";import{a as Qa,b as Ut}from"https://app.framerstatic.com/chunk-M6B6RIGQ.mjs";import{b as dl}from"https://app.framerstatic.com/chunk-XIH76ID4.mjs";import"https://app.framerstatic.com/chunk-AI2U4NHW.mjs";import"https://app.framerstatic.com/chunk-RIGFMZJN.mjs";import"https://app.framerstatic.com/chunk-YWBVRV5Y.mjs";import{j as es}from"https://app.framerstatic.com/chunk-FYIXH5NI.mjs";import"https://app.framerstatic.com/chunk-JL4HL32A.mjs";import"https://app.framerstatic.com/chunk-YS3B4HMG.mjs";import{a as wl,d as Cl}from"https://app.framerstatic.com/chunk-L3CECRJ4.mjs";import"https://app.framerstatic.com/chunk-TCPSFRTF.mjs";import"https://app.framerstatic.com/chunk-CJWUTPXZ.mjs";import"https://app.framerstatic.com/chunk-IM24HCZX.mjs";import{a as ll}from"https://app.framerstatic.com/chunk-FDX2C2EY.mjs";import{a as $s}from"https://app.framerstatic.com/chunk-46WL6RWF.mjs";import{c as Ns,d as Ds}from"https://app.framerstatic.com/chunk-LDU7O3Z2.mjs";import{a as Ts}from"https://app.framerstatic.com/chunk-YQTEBD26.mjs";import{e as At,h as Qo,k as er,l as nt,s as se}from"https://app.framerstatic.com/chunk-MUPUEJHJ.mjs";import{Fe as mn,Ge as pn,Lc as pa,Ma as cn,Pd as Yo,Vd as Nt,Xc as ua,Xe as Ia,Xh as $o,Ye as Ua,Yh as xa,Ze as wa,_e as Ca,ii as Pa,jb as Go,pe as ha,qe as ya,vd as Tt}from"https://app.framerstatic.com/chunk-TN2YRK56.mjs";import{e as ga,f as Re}from"https://app.framerstatic.com/chunk-7P43TZHS.mjs";import"https://app.framerstatic.com/chunk-Y4KSD2WZ.mjs";import{a as Hs}from"https://app.framerstatic.com/chunk-7GEELX35.mjs";import"https://app.framerstatic.com/chunk-IMYWFMVZ.mjs";import"https://app.framerstatic.com/chunk-75ILXMIH.mjs";import"https://app.framerstatic.com/chunk-SWWNIYQZ.mjs";import{a as Ul}from"https://app.framerstatic.com/chunk-WJOINHW7.mjs";import"https://app.framerstatic.com/chunk-2W7AVDV6.mjs";import"https://app.framerstatic.com/chunk-DMH54IDO.mjs";import{Ag as Za,Be as Ma,Ef as Ka,Ff as qa,He as La,Ie as ve,Kf as qt,Lf as Gt,Nf as Yt,Oe as K,Pf as Zo,Pg as Ja,R as Da,Ue as rt,Zc as Oa,Ze as Va,Zf as Ga,_ as Ra,b as Sa,bf as za,ef as Wa,h as Na,mb as Ba,mf as Xo,n as Aa,qf as Ha,rf as ja,uf as _a,ug as Ya,vg as $a,wb as ka,zg as Xa}from"https://app.framerstatic.com/chunk-CCQODFB2.mjs";import"https://app.framerstatic.com/chunk-AL6SYENZ.mjs";import{a as pr}from"https://app.framerstatic.com/chunk-YG7B2GEO.mjs";import{a as qs}from"https://app.framerstatic.com/chunk-N3V4MJLQ.mjs";import{a as q}from"https://app.framerstatic.com/chunk-QFU6OGL3.mjs";import{a as Ks,b as Gs,c as Ys}from"https://app.framerstatic.com/chunk-SDISSWE6.mjs";import"https://app.framerstatic.com/chunk-LFMZ3QM5.mjs";import{Rn as ma,We as Et,Wf as dn,_j as fn,gb as It,gc as wo,hb as la,i as an,ib as Ho,ij as qo,k as na,kb as jo,sf as ln,t as sn,ub as _o,vb as Ko,yh as da}from"https://app.framerstatic.com/chunk-4ENT6ED6.mjs";import{e as sa}from"https://app.framerstatic.com/chunk-6C6VSETA.mjs";import"https://app.framerstatic.com/chunk-FYUJQV6J.mjs";import"https://app.framerstatic.com/chunk-KYPY4QS7.mjs";import{a as ia,b as W}from"https://app.framerstatic.com/chunk-YDKXOXB4.mjs";import"https://app.framerstatic.com/chunk-XFC6OVIX.mjs";import"https://app.framerstatic.com/chunk-BGDT2J4O.mjs";import{a as $t}from"https://app.framerstatic.com/chunk-7GSEC7H4.mjs";import"https://app.framerstatic.com/chunk-IZHOZLZY.mjs";import{e as Ea,i as Ta,k as pe}from"https://app.framerstatic.com/chunk-SQM4W52F.mjs";import"https://app.framerstatic.com/chunk-67IDBBKJ.mjs";import"https://app.framerstatic.com/chunk-GZI43NW3.mjs";import"https://app.framerstatic.com/chunk-OIGMOVXH.mjs";import"https://app.framerstatic.com/chunk-LZDNIQ2U.mjs";import"https://app.framerstatic.com/chunk-WGFZOR67.mjs";import{a as Ps,b as vs}from"https://app.framerstatic.com/chunk-EIMGQUJC.mjs";import{$b as Mo,Bn as Wo,D as re,Dp as oa,Ee as Kt,Ep as ra,K as Ne,La as Ri,Lm as Xi,Rj as X,Sc as Vi,Uc as zi,Vj as yt,Vo as ta,Ye as Ki,Zb as Mi,ak as $i,cc as me,cd as Vo,cs as ca,dd as Wi,fd as tn,hc as Lo,jd as Hi,ji as Gi,ls as De,m as Ti,ob as en,ot as fa,pb as Oi,pd as S,pe as ji,pr as Xe,qb as Oo,qd as Ae,qe as _i,qj as Yi,qo as ea,rb as L,ud as _t,un as zo,up as nn,vc as Li,vd as $e,wn as Uo,xm as rn,xr as aa,yk as on}from"https://app.framerstatic.com/chunk-J76SGVV5.mjs";import"https://app.framerstatic.com/chunk-AYYBTPZU.mjs";import"https://app.framerstatic.com/chunk-WW2GMRT4.mjs";import{S as ut,ba as Zi,ja as Ji,ka as Qi,x as Ai}from"https://app.framerstatic.com/chunk-EKPHZC6W.mjs";import"https://app.framerstatic.com/chunk-XFC6OVIX.mjs";import"https://app.framerstatic.com/chunk-REJ2XCEK.mjs";import{a as R,b as Ni}from"https://app.framerstatic.com/chunk-BUC334RG.mjs";import{a as ae,d as qi}from"https://app.framerstatic.com/chunk-5CKCK72G.mjs";import"https://app.framerstatic.com/chunk-POQKH4YA.mjs";import{p as ht,r as ki}from"https://app.framerstatic.com/chunk-CYFZYBQN.mjs";import"https://app.framerstatic.com/chunk-AUNF3KWQ.mjs";import{b as V,e as Io,f as gt,g as ko,j as Pe,n as Qr,p as Bi}from"https://app.framerstatic.com/chunk-CMAEAGWD.mjs";import{Me as Di,bf as Ye}from"https://app.framerstatic.com/chunk-BR6A4V35.mjs";import{a as Q,b as w}from"https://app.framerstatic.com/chunk-JB2N3EQZ.mjs";import"https://app.framerstatic.com/chunk-BKY3ZXGT.mjs";import{f as Ei}from"https://app.framerstatic.com/chunk-LEPWVMNB.mjs";import{Oa as yo,Pa as Bo,U as ie,X as Do,j as Ao,la as Si}from"https://app.framerstatic.com/chunk-BM3S62FQ.mjs";import{a as m,b as jt}from"https://app.framerstatic.com/chunk-YOOGIIWU.mjs";import{a as Ro}from"https://app.framerstatic.com/chunk-HMF7T2NG.mjs";import{e as y,f as te,g as oe,h as x,i as b,j as U,k as Ht,l as T,m as No}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var od=y(w(),1),nm={BooleanControlPropRow:ur,EnumControlPropRow:xo,StringControlPropRow:Po};function td({children:r}){return(0,od.jsx)(ul.Provider,{value:nm,children:r})}var wn="data-chrome";function rd(r){return r instanceof HTMLElement?r.closest(`[${wn}]`)!==null:!1}var Cn="data-floating-canvas-chrome";function nd(r){return r instanceof Element?r.closest(`[${Cn}]`)!==null:!1}function id(){return window}function xn(){return id().secureFrameAncestors}function eo(){R(xn(),"Must have secure frame ancestors.")}var Dr=y(Q(),1);var ad="c1gxt05z",sd="n1sd5akc";var Ze=y(Q(),1);var Pn=y(w(),1);function ld({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];return R(l?.type==="boolean"),(0,Pn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Pn.jsx)(zl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{se(d)&&i(t,d)}})})}var dd="o1kosemn",cd="o1tcokht",fd="o11jr4ka",am=1,md=`calc(${pe.css.panelPadding} + ${am}px)`,pd="oaqx903",yr="b1gqim6f";var ud="wje69dc",gd="i1rqgchl",hd="ixghur2",yd="c1d0unc6";var vn=y(w(),1);function Id({collectionNode:r,controlProp:o,variableId:e,warningMessage:t,onChange:n}){let i=W(),s=r.getPropertyControls(i.tree,i.componentLoader)[e];R(s?.type==="collectionreference");let l=oa(s,o);R(!L(l),"Variables are not supported");let d=s.dataIdentifier;function u(f){n(e,{type:"collectionreference",value:f})}return(0,vn.jsx)(H,{title:s.title??"",warningMessage:t,children:(0,vn.jsx)(xl,{large:!0,value:l,onChange:u,className:gd,dataIdentifier:d,wrapperClassName:Ki(ud,yd),iconClassName:hd})})}var Fn=y(w(),1);function Ud({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];return R(l?.type==="color"),(0,Fn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Fn.jsx)(Wl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{se(d)&&i(t,d)},ColorPickerPopoutComponent:pl})})}var bn=y(w(),1);function wd({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];return R(l?.type==="date"),(0,bn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,bn.jsx)(Hl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{se(d)&&i(t,d)},required:!1})})}var Sn=y(w(),1);function Cd({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];return R(l?.type==="enum"),(0,Sn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Sn.jsx)(jl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{se(d)&&i(t,d)}})})}var En=y(w(),1);function xd({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];if(R(l?.type==="file"),R(!me(e?.value),"Dynamic values are not supported within required field validation"),e&&e?.type!=="file")return null;let u=(e?.value??"").split(".").pop(),f=!u||l.allowedFileTypes.length===0||l.allowedFileTypes.includes(u);return(0,En.jsx)(H,{title:l.title??"",warningMessage:n,showWarningTint:!f,children:(0,En.jsx)(_l,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:p=>{se(p)&&i(t,p)},reset:()=>{i(t,{type:"file",value:void 0})}})})}var Tn=y(w(),1);function Pd({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,onChange:n}){let i=W(),a=qi(h=>{let c=h(e);c&&n(t,c)}),l=o.getPropertyControls(i.tree,i.componentLoader)[t];if(R(l?.type==="array"),R(!e||$i(e)),!is(l))return null;let d=rl(e,l,!0),u=nl(e,l,!0),p=cr(d??u,l);return(0,Tn.jsx)(H,{title:l.title??"",warningMessage:p,children:(0,Tn.jsx)(Ll,{collectionId:o.id,control:l,fieldId:t,controlProp:e,itemId:r.id,onChange:a,required:!1})})}var Nn=y(w(),1);function vd({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];return R(l?.type==="responsiveimage"),(0,Nn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Nn.jsx)(Kl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{let u=d(e);se(u)&&i(t,u)},reset:()=>{let d={type:"image",value:void 0};i(t,d)}})})}var An=y(w(),1);function Fd({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];return R(l?.type==="link"),(0,An.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,An.jsx)(ql,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{se(d)&&i(t,d)},reset:()=>{let d={type:"link",value:void 0};i(t,d)}})})}var bd="i4uywus";var Dn=y(w(),1);function Sd({collectionNode:r,controlProp:o,variableId:e,warningMessage:t,onChange:n}){let i=W(),s=r.getPropertyControls(i.tree,i.componentLoader)[e];m(s?.type==="multicollectionreference");let l=s.dataIdentifier,d=ra(s,o)??[];return m(!me(d),"Dynamic values are not supported"),(0,Dn.jsx)(H,{title:s.title??"",warningMessage:t,children:(0,Dn.jsx)(Ol,{large:!0,value:d,onChange:u=>{n(e,{type:"multicollectionreference",value:u})},wrapperClassName:bd,dataIdentifier:l})})}var Rn=y(w(),1);function Ed({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,a.componentLoader)[t];return R(l?.type==="number"),(0,Rn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Rn.jsx)(Gl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{se(d)&&i(t,d)}})})}var Bn=y(w(),1),cm=["left","right","auto-vertical"];function Td({collectionNode:r,collectionItemNode:o,controlProp:e,variableId:t,onChange:n,warningMessage:i}){let a=W(),l=r.getPropertyControls(a.tree,a.componentLoader)[t];m(l?.type==="richtext");let d=e&&Ai(e.value)?e.value:void 0,u=p=>{n(t,{type:l.type,value:p})},f=pr(()=>It(jo));return(0,Bn.jsx)(H,{title:l.title??"",warningMessage:i,children:(0,Bn.jsx)(gr,{enabled:!0,schema:f,compactTagSelector:!0,defaultValue:d??"",onChange:u,scopeType:"ContentManagement",onUnsavedChange:$t,popoverAttachmentEdge:cm,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0},o.id)})}var Ir=y(w(),1);function Nd({collectionNode:r,collectionItemNode:o,controlProp:e,variableId:t,onChange:n,warningMessage:i}){let a=W(),l=r.getPropertyControls(a.tree,a.componentLoader)[t];m(l?.type==="string");let d=e&&V(e.value)?e.value:void 0,u=l.placeholder,f=l.defaultValue??"",p=d??f,h=c=>{n(t,{type:l.type,value:c})};return(0,Ir.jsx)(H,{title:l.title??"",warningMessage:i,children:l.displayTextArea?(0,Ir.jsx)(Ha,{value:p,onChange:h,constantChange:!0,placeholder:u,minRows:10,maxRows:30,className:$l},o.id):(0,Ir.jsx)(ja,{type:l.obscured?"password":"text",value:p,onChange:h,placeholder:u,constantChange:!0,className:Vl})})}var O=y(w(),1);function Dd({fieldIdsToShow:r,requiredFieldsOnly:o,collectionItemId:e,collectionNodeId:t}){let[n,i]=(0,Ze.useState)(!0),[a,s]=(0,Ze.useState)(()=>new Map),l=a.size>0,d=C(),{treeStore:u,projectStore:f,modalStore:p}=d.stores,h=e!==d.stores.canvasStore.temporaryCollectionItemNodeId,c=u.tree.getNodeWithTrait(t,_t),I=u.tree.getNodeWithTrait(e,$e),g=(0,Ze.useCallback)(D=>a.get(D)??I?.getControlProp(D),[a,I]);(0,Ze.useEffect)(()=>{(!I||!c||I.parentid!==c.id)&&p.dismiss()},[I,c,p]);let v=o||h,F=()=>{for(let[D,B]of a)u.tree.current(I)?.setControlProp(D,B);v?h?(u.tree.current(I)?.set({privateToUserId:void 0}),f.commitTreeAndSend()):d.stores.canvasStore.saveTemporaryCollectionItem():f.commitTreeAndSend(),p.dismissAll()},N=()=>{if(!ar()){if(h&&_.size>0){i(!1);return}F()}},_=mm({collectionNode:c||void 0,collectionItemNode:I||void 0,tempControlProps:a,fieldIdsToShow:r});function ne(D){let Ke=c?.getPropertyControls(u.tree,d.componentLoader)?.[D];if(!Ke)return;let tt=_.get(D);if(!(tt?.type==="required"&&!(h&&!n)))return cr(tt,Ke)}let je=(D,B)=>{m(I,"CollectionItemNode must be present");let Ke=I.getControlProp(D);s(tt=>Ke?.value===B.value?yo.remove(tt,D):ko(Ke?.value)&&ko(B.value)&&pm(Ke.value,B.value)?yo.remove(tt,D):Ad(Ke)&&Ad(B)?yo.remove(tt,D):yo.set(tt,D,B))},_e=()=>{if(!l){Ee();return}p.push({type:"Confirmation",title:"Unsaved Changes",description:"Are you sure that you want to discard your new item?",interactionRequired:!0,onConfirm:()=>Ee(),cancelLabel:"Continue Editing",confirmLabel:"Discard Item",dismissVariant:"primary",variant:"destructiveSecondary",cancelOnEnter:!0,confirmOnEnter:!1,source:"on_page_hud",buttonDirection:"column",hasBackdrop:!0})},Ee=()=>{I&&(u.tree.remove(I.id),f.commitTreeAndSend(),p.dismiss())},ft=()=>{if(h){_e();return}if(o){p.dismiss();return}F()},mt=()=>{if(h){_e();return}p.dismiss()};return(0,O.jsxs)(qt,{hasBackdrop:!0,className:dd,visible:r.length>0,onDismiss:ft,onConfirm:N,children:[(0,O.jsx)(Gt,{separator:!0,title:h?"New Item":o?"Required Fields":"All Fields",className:cd,children:(0,O.jsx)(Yt,{onDismiss:mt})}),(0,O.jsxs)(Ja,{className:fd,children:[(0,O.jsx)(Ga,{size:0}),r.map(D=>{if(!c||!I)return null;let B=c.getVariable(D);return B?(0,O.jsx)(fm,{variable:B,collectionItemNode:I,collectionNode:c,getControlProp:g,onChange:je,getWarningMessage:ne},D):null})]}),(0,O.jsx)(Zo,{displayDivider:!1,paddingTop:md,className:pd,children:(0,O.jsxs)(Sa,{children:[o?(0,O.jsx)(K,{bold:!0,onClick:mt,className:yr,children:(0,O.jsx)(rt,{children:"Cancel"})}):(0,O.jsx)(K,{bold:!0,onClick:mt,className:yr,children:(0,O.jsx)(rt,{children:l?"Discard":"Cancel"})}),(0,O.jsx)(K,{bold:!0,type:"submit",variant:"primary",className:yr,enabled:o?_.size===0:l,children:(0,O.jsx)(rt,{children:"Save"})})]})})]})}function fm({variable:r,collectionItemNode:o,collectionNode:e,getControlProp:t,onChange:n,getWarningMessage:i}){let a=(0,Ze.useMemo)(()=>t(r.id),[t,r.id]),s=r.type;switch(s){case"slug":{if(!Uo(r))return null;let l=r.associatedStringVariable?t(r.associatedStringVariable):void 0,d=l&&V(l.value)?l.value:void 0;return(0,O.jsx)(Yl,{associatedVariableString:d,collectionNode:e,controlProp:a,onChange:n,variable:r,warningMessage:i(r.id)})}case"string":return(0,O.jsx)(Nd,{collectionNode:e,collectionItemNode:o,controlProp:a,variableId:r.id,onChange:n,warningMessage:i(r.id)});case"richtext":return(0,O.jsx)(Td,{collectionNode:e,collectionItemNode:o,controlProp:a,variableId:r.id,onChange:n,warningMessage:i(r.id)});case"link":return(0,O.jsx)(Fd,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"image":return(0,O.jsx)(vd,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"array":return(0,O.jsx)(Pd,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,onChange:n});case"multicollectionreference":return(0,O.jsx)(Sd,{collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"collectionreference":return(0,O.jsx)(Id,{collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"file":return(0,O.jsx)(xd,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"date":return(0,O.jsx)(wd,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"number":return(0,O.jsx)(Ed,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"boolean":return(0,O.jsx)(ld,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"enum":return(0,O.jsx)(Cd,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});case"color":return(0,O.jsx)(Ud,{collectionItemNode:o,collectionNode:e,controlProp:a,variableId:r.id,warningMessage:i(r.id),onChange:n});default:Ni(s)}}function mm({collectionNode:r,collectionItemNode:o,tempControlProps:e,fieldIdsToShow:t}){let n=C(),i=P(()=>n.stores.treeStore.tree,[]),a=ol(r,o);return(0,Ze.useMemo)(()=>{let s=new Map;if(!r||!o)return s;for(let l of t){let d=r.getVariable(l);if(!d)continue;let f=r.getPropertyControls(i,n.componentLoader)[l];if(!f)continue;let p=e.get(l)??o.getControlProp(l),h=a.get(l),c;(zo(d)||Uo(d))&&(c=lr(d,r.variables,o));let I=dr(d.type,f,p,c,void 0,Wo(d),h);I&&s.set(l,I)}return s},[r,o,t,a,i,e])}function Ad(r){return!r||Bi(r.value)?!0:V(r.value)?as(r.value):ko(r.value)?r.value.length===0:!1}function pm(r,o){if(r.length!==o.length)return!1;let e=r.length;for(let t=0;t<e;t++)if(r[t]!==o[t])return!1;return!0}var wr=y(Q(),1);var Rd="e1zu74n";var kd=y(w(),1);function Bd({initialHtml:r,onContentChange:o,onEscape:e}){let t=(0,wr.useRef)(null);return(0,wr.useEffect)(()=>{let n;async function i(){let{baseKeymap:a,chainCommands:s,dropCursor:l,gapCursor:d,history:u,keymap:f,redo:p,undo:h,undoInputRule:c}=await Zt(),I=It(Ho),g=Ko(r,I,{plugins:[u(),f({"Mod-z":s(c,h),"Mod-Shift-z":p,"Shift-Enter":or(I),"Mod-b":hn(I.marks.bold),"Mod-i":hn(I.marks.italic),"Shift-Tab":ps(I.nodes.listItem),Tab:s(us(I.nodes.listItem),()=>!0),Backspace:s(c,rr(I)),Escape:()=>(e?.(),!!e)}),f(a),l({color:"var(--framer-color-text)",width:2}),d(),nr()]}),v,F=new sa(null,{state:g,editable:()=>!0,dispatchTransaction:N=>{let _=F.state.apply(N);if(F.updateState(_),v!==_.doc){let ne=_o(_.doc,I);o(ne),v=_.doc}}});t.current&&(t.current.innerHTML="",t.current.appendChild(F.dom)),n=F}return i(),()=>n?.destroy()},[r,o,e]),(0,kd.jsx)("div",{ref:t,className:Rd})}function lt({tree:r,webPageNodeId:o}){let e=r.getNodeWithTrait(o,Hi);if(e?.loaded)return e.loaded;e?.load().catch(ie)}function ce({screenWidth:r,tree:o,webPageNodeId:e}){let n=lt({tree:o,webPageNodeId:e})?.getBreakpointValues(),i=ta(n,r);return o.get(i)}function Je(r,o,e){let t=e.temporaryCollectionItemNodeId??r.collectionItemNodeId;return o.tree.getNodeWithTrait(t,$e)??void 0}function to(r,o,e){let t=Je(r,o,e);if(t)return o.tree.getNodeWithTrait(t.parentid,_t)??void 0}function Oe(r){return window.editorBarFeatures[r]===!0}var G=class{constructor(o){this.engine=o;U(this,"scheduler");this.scheduler=o.scheduler}};function Me(r,o,e){let t=e(o.id),i=ds(o,r).find(s=>s.keyPath===t);if(i)return i;if(!o.originalid)return;let a=r.tree.getNode(o.originalid);if(a)return Me(r,a,e)}function dt(r,o){let e=Xe(r.tree,r.stores.routeStore.localeId);return e&&Oe("onPageLocalizationSupport")&&e.id!==Kt?yt(e,o.valueLocalized):null}function oo(r,o,e){let t=r.tree.root.getLocale(r.stores.routeStore.localeId),n=o.value;m(V(n),"Control prop value must be a string");let i=dt(r,o);if(i&&t?.id!==Kt){let a=nt(i.value),s=er(a,i,n);if(s)return e?Tt(n,s.value):s.type==="rich-text"?Qo(n,s.value):Tt(n,s.value)}return n}function Cr(r,o,e,t){let{controlProp:n,collectionItemNode:i}=o,s=dt(r,n)?.value??n.value,l=r.tree.root.getLocale(r.stores.routeStore.localeId);if(m(l.id!==Kt,"Active locale must be a non-default locale"),!V(s)){r.exitTool();return}let d=Tt(s,e),u=Me(r,t,()=>wt(i.id,o.variableId,void 0));m(u,"There must be a localization source for updating a localized value");let f=Nt(d);it(r,f,u,l,{trackingSource:"on-page-rich-text-edit-tool"})}function ro(r,o,e,t,n,i,a){let s=Me(r,o,i);if(!s){r.exitTool();return}let d=(a??nt(e))==="rich-text"?tr(t):Nt(t);it(r,d,s,n,{trackingSource:"on-page-rich-text-edit-tool"})}var gm=/^(?<hashes>#{1,6})\s$/u,ue=class r extends G{constructor(e,t,n,i="none"){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;U(this,"handleOnFocus",()=>this.proseMirrorEditor?.controls.handleOnFocus());U(this,"handleOnBlur",()=>this.proseMirrorEditor?.controls.handleOnBlur());U(this,"proseMirrorEditor",null);U(this,"hasTextFitViewBox",!1);U(this,"isEditingPlainTextLocalizedValue");this.engine.beginUndoGroup();let a=this.getRichTextNode();if(a){let s=nt(a.html),d=this.engine.stores.routeStore.localeId!==X&&s!=="rich-text";this.isEditingPlainTextLocalizedValue=d}this.start()}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,S)}update(){let e=this.getRichTextNode();if(!e||!r.supportsNode(this.engine,e)){this.engine.exitTool();return}let t=this.engine.stores.routeStore.localeId,n=nt(e.html),i=t!==X&&n!=="rich-text";if(this.isEditingPlainTextLocalizedValue!==void 0&&i!==this.isEditingPlainTextLocalizedValue){this.engine.exitTool();return}if(!e.textFitViewBoxSize||this.hasTextFitViewBox)return;let a=Ca(this.engine.tree,e);this.engine.stores.projectStore.commitTreeAndSend(),a&&(this.hasTextFitViewBox=!0)}async stop(){let e=this.getRichTextNode();e&&(e.cache.isEditable=!1),this.proseMirrorEditor?.destroy(),this.proseMirrorEditor=null,this.engine.endUndoGroup(),this.engine.stores.toolStore.proseMirrorView=null,this.engine.stores.toolStore.nodeInTextEditorId=null}start(){let e=this.getRichTextNode();if(!e)return;this.hasTextFitViewBox=Ia(this.engine.tree,e),this.engine.stores.projectStore.commitTreeAndSend();let t=ir(this.engine.tree,e);if(t.length===0){this.init();return}ut.loadFonts(t).catch(ie).finally(()=>this.init())}init(){this.startAsync().catch(e=>{ie(e),this.engine.exitTool()})}async startAsync(){let e=this.getRichTextNode();if(!e)return this.engine.exitTool();this.proseMirrorEditor=await this.createProseMirrorEditor(e),e.cache.isEditable=!0,this.engine.stores.toolStore.proseMirrorView=this.proseMirrorEditor.view}async createProseMirrorEditor(e){let{baseKeymap:t,chainCommands:n,createParagraphNear:i,Decoration:a,DecorationSet:s,dropCursor:l,EditorView:d,ellipsis:u,emDash:f,gapCursor:p,history:h,InputRule:c,inputRules:I,keymap:g,liftEmptyBlock:v,liftListItem:F,newlineInCode:N,redo:_,sinkListItem:ne,splitBlock:je,splitListItem:_e,toggleMark:Ee,undo:ft,undoInputRule:mt}=await Zt(),D=this.engine,B=It(Ho),Ke=n(_e(B.nodes.listItem),N,i,v,hs(B),gs(B),(ee,$)=>je(ee,$&&(J=>{let Te=ee.selection,qe=this.getRichTextNode();m(qe,"RichTextNode not found");let Ge=Te.$from.node(1);if(!sn(Ge)||!(Te.$to.parentOffset===Te.$to.parent.content.size))return $(J);let xe={...Ge.attrs},St=an(Ge)&&xe.tag!=="p",ho=J.mapping.map(ee.selection.to),Wt=ee.selection.$from.marks();if(St){let ot=qe.getNodeTextStylePreset(D.tree,"p")??mn(D.tree,"p")??cn.createDefault("p");pn(D,ot),qe.setNodeTextStylePreset(ot),D.stores.projectStore.commitTreeAndSend(),xe.textStylePreset=ot.id,xe.tag="p",xe.inlineStyles={},xe.blockStyles={}}else{let ot=Wt.find(na);xe.inlineStyles={...xe.inlineStyles,...ot?.attrs.inlineStyles}}J.setNodeMarkup(ho-1,void 0,xe),J.setStoredMarks(Wt),St&&J.removeStoredMark(B.marks.inlineStyles),$(J)})));function tt(){return D.exitTool(),!0}m(!L(e.htmlContent),"Can't edit rich text node when htmlContent variable is assigned"),m(!L(e.textContent),"Can't edit rich text node when textContent variable is assigned");let Jr=()=>{let ee=this.getRichTextNode();m(ee,"RichTextNode not found");let $=ee.getNodeInlineCodeStylePreset(D.tree)??ha(D.tree)??new ua;return ya(D,$),ee.setNodeInlineCodeStylePreset($),$.id},Pi=(ee,$,J)=>Ko(ee,$,J),vi=ym(D,e),Fi=Pi(vi,B,{plugins:[h(),g({"Mod-z":n(mt,ft),"Mod-Shift-z":_,"Shift-Enter":or(B),...this.isEditingPlainTextLocalizedValue?{}:{"Mod-b":Ee(B.marks.bold),"Mod-i":Ee(B.marks.italic)},"Shift-Tab":F(B.nodes.listItem),Tab:n(ne(B.nodes.listItem),()=>!0),Backspace:n(mt,rr(B)),Escape:tt,Enter:Ke,"Mod-Shift-c":Ee(B.marks.inlineCode,{get inlineCodeStylePreset(){return Jr()}})}),g(t),l({color:Ta.cmsRichTextDropCursor,width:pe.values.richTextDropCursor}),p(),nr(),xs({engine:this.engine,schema:B,nodeId:this.nodeId,getRichTextNode:()=>this.getRichTextNode()}),I({rules:[f,u,new c(gm,(ee,$,J,Te)=>{let qe=ee.doc.resolve(J),Ge=qe.node(1),To=qe.before(1);if(!sn(Ge))return null;let xe=ee.tr,St="h"+($.groups?.hashes?.length||1),ho=this.getRichTextNode();m(ho,"RichTextNode not found");let Wt=ho.getNodeTextStylePreset(D.tree,St)??mn(D.tree,St)??cn.createDefault(St),ot=Wt.id;return pn(D,Wt),ho.setNodeTextStylePreset(Wt),D.stores.projectStore.commitTreeAndSend(),an(Ge)||xe.removeMark(To,To+Ge.nodeSize,B.marks.inlineStyles),xe.delete(J,Te),xe.setNodeMarkup(To,B.nodes.textBlock,{...Ge.attrs,blockStyles:ot?{}:Ge.attrs.blockStyles,inlineStyles:ot?{}:Ge.attrs.inlineStyles,textStylePreset:ot,tag:St}),xe}),ys(B),Is(B)]}),...ms({markType:B.marks.inlineCode,attrs:{get inlineCodeStylePreset(){return Jr()}}})]}),bi,pt=new d(null,{state:Fi,dispatchTransaction:ee=>{let $=D.tree.root.getLocale(D.stores.routeStore.localeId),J=this.getRichTextNode();m(J,"Node should not be null");let Te=pt.state.apply(ee);if(pt.updateState(Te),Te=Ua(Te,pt,J),bi!==Te.doc){let qe=_o(Te.doc,B);J.html!==qe&&($&&$.id!==X&&Oe("onPageLocalizationSupport")?ro(D,J,J.html,qe,$,ss):r.updateNodeWithBreakpointAwareness({engine:this.engine,html:qe,node:J}),wa(J,pt)),bi=Te.doc}this.engine.stores.projectStore.commitTreeAndSend()}});return{controls:{handleOnFocus(){pt.setProps({decorations(){}})},handleOnBlur(){pt.setProps({decorations(ee){let $=ee.selection;if($.from!==$.to)return document.getSelection()?.removeAllRanges(),s.create(ee.doc,[a.inline($.from,$.to,{class:"selection",nodeName:"mark"})])}})}},destroy:()=>pt.destroy(),state:Fi,view:pt}}static updateNodeWithBreakpointAwareness({engine:e,node:t,html:n,breakpointNode:i}){let{tree:a,stores:s}=e,{routeStore:l,canvasStore:d,treeStore:u}=s;i??=ce({screenWidth:d.screenWidth,tree:u.tree,webPageNodeId:l.webPageNodeId});let f=t.getPrimaryId(),p=!Vi(i)||Yi(i)||!f,h=!qo(a,t,"html"),c=a.getNodeWithTrait(f,S);if(m(c,`originalNode with id ${f} must exist`),p||h){c.set({html:n});return}if(t.getTextContent()===c.getTextContent()){c.set({html:Tt(c.html,Nt(n))});return}t.set({html:n},a,!1,!1)}static supportsNode(e,t){return!S(t)||e.tree.root.getLocale(e.stores.routeStore.localeId).id!==X&&t.textFitViewBoxSize?!1:!t.htmlContent&&!t.textContent}};function hm(r,o){let e=Xe(r.tree,r.stores.routeStore.localeId);return e&&o.htmlLocalized&&Oe("onPageLocalizationSupport")?yt(e,o.htmlLocalized):null}function ym(r,o){let e=hm(r,o);if(e){let t=nt(o.html),n=er(t,e,o.html);return n?n.type==="rich-text"?Qo(o.html,n.value):Tt(o.html,n.value):o.html}return o.html}function ge(){let r=C();return P(()=>lt({tree:r.tree,webPageNodeId:r.stores.routeStore.webPageNodeId}),[])}function Od(){let r=C(),{routeStore:o,treeStore:e,canvasStore:t}=r.stores;return at(()=>Je(o,e,t),[],[o,e,t])}function Md(){let r=C(),{routeStore:o,treeStore:e,canvasStore:t}=r.stores;return at(()=>to(o,e,t),[],[o,e,t])}var Fe=y(Q(),1);var Ld="m168h77v";var he=y(w(),1);function Vd({richTextNodeId:r}){let o=C(),e=ge(),[t,n]=(0,Fe.useState)(()=>{let c=ce({screenWidth:o.stores.canvasStore.screenWidth,tree:o.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});return m(c,"activeOnPageBreakpointNode must exist"),c.id}),i=(0,Fe.useRef)(new Map),a=(0,Fe.useMemo)(()=>{let c=o.stores.treeStore.tree.getNodeWithTrait(r,S);return c?c.getPrimaryId():r},[r]),s=(0,Fe.useCallback)(()=>o.stores.scopeStore.active.getTopLevelReplicaVariants().find(({id:c})=>t===c),[t]),l=(0,Fe.useCallback)(()=>{let c=s();if(!c)return;let I=wo(c.id,a),g=o.stores.treeStore.tree.get(I);return S(g)?g:void 0},[s,a]),d=P(()=>o.stores.scopeStore.active.getPrimaryVariant().id,[]),u=(0,Fe.useMemo)(()=>{let c=i.current.get(t);if(c!==void 0)return c;if(t===d){let I=o.stores.treeStore.tree.getNodeWithTrait(a,S);return m(I,"originalNode should exist"),I.html}return l()?.html??""},[l,d,t,a]),f=(0,Fe.useCallback)(c=>i.current.set(t,c),[t]),p=(0,Fe.useCallback)(()=>{o.exitTool(),o.stores.modalStore.dismiss()},[]),h=(0,Fe.useCallback)(()=>{let c=o.stores.scopeStore.active.getPrimaryVariant(),I=i.current.get(c.id);if(I!==void 0){let g=o.stores.treeStore.tree.getNodeWithTrait(a,S);m(g,`originalNode with id ${a} must exist`),g.html!==I&&g.set({html:I})}o.stores.scopeStore.active.getTopLevelReplicaVariants().forEach(g=>{let v=i.current.get(g.id);if(v===void 0)return;let F=wo(g.id,a),N=o.stores.treeStore.tree.get(F);S(N)&&N.html!==v&&ue.updateNodeWithBreakpointAwareness({breakpointNode:g,engine:o,html:v,node:N})}),i.current.clear(),o.stores.projectStore.commitTreeAndSend(),p()},[p,a]);return(0,he.jsxs)(qt,{visible:!0,hasBackdrop:!0,onDismiss:p,className:Ld,children:[(0,he.jsx)(Gt,{separator:!0,title:"Responsive Text",children:(0,he.jsx)(Yt,{onDismiss:p})}),(0,he.jsxs)(ve,{gap:pe.css.inputSpacing,paddingTop:pe.css.modalPadding,children:[(0,he.jsx)(Za,{children:e?.getTopLevelVariants().map(c=>(0,he.jsx)(Xa,{identifier:c.id,title:c.resolveValue("name")??c.id,selected:t===c.id,onSelect:n},c.id))}),(0,he.jsx)(Bd,{initialHtml:u,onContentChange:f,onEscape:p})]}),(0,he.jsxs)(Zo,{displayDivider:!0,children:[(0,he.jsx)(K,{bold:!0,onClick:p,variant:"default",children:(0,he.jsx)(rt,{children:"Cancel"})}),(0,he.jsx)(K,{bold:!0,onClick:h,variant:"primary",children:(0,he.jsx)(rt,{children:"Save"})})]})]})}var ye=class r extends G{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;U(this,"controls");this.engine.beginUndoGroup(),Zt().then(a=>{e.stores.toolStore.proseMirror??=a})}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,S)}getVariableReference(){let e=this.getRichTextNode();if(!e)return;let t=e.htmlContent;if(L(t))return t}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=this.getVariableReference();if(n)return M(this.engine.tree,this.engine.componentLoader,this.engine.stores.treeStore.sandboxRepeaterData,n,"richtext",t.repeaterItemId)}getValue(){let e=this.getVariableInfo();if(!e)return;let{controlProp:t}=e;return m(t,"Control prop must exist"),oo(this.engine,t)}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;m(a,"Control prop must exist");let s=this.engine.tree.root.getLocale(this.engine.stores.routeStore.localeId);if(s.id!==X){let d=dt(this.engine,a)?.value??a.value;if(!V(d)){this.engine.exitTool();return}r.updateLocalizedValue(this.engine,n,i.id,d,e,s)}else{if(a.value===e)return;n.setControlProp(i.id,{...a,value:e})}this.engine.stores.projectStore.commitTreeAndSend()}static updateLocalizedValue(e,t,n,i,a,s,l=nt(i)){let d=Me(e,t,()=>wt(t.id,n,void 0));m(d,"There must be a localization source for updating a localized value");let u=l==="rich-text"?tr(a):Nt(a);it(e,u,d,s,{trackingSource:"on-page-rich-text-edit-tool"})}update(){let e=this.engine,t=this.getRichTextNode();if(!t||!r.supportsNode(e,t,this.renderId))e.exitTool();else{let n=this.getVariableInfo();this.engine.stores.toolStore.validateCollectionControl(n)}}stop(){this.engine.endUndoGroup(),this.engine.stores.toolStore.nodeInTextEditorId=null}static supportsNode(e,t,n){if(!S(t)||!L(t.htmlContent))return!1;let i=t.cache.getRenderInstance(n);return i?!!M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,t.htmlContent,"richtext",i.repeaterItemId):!1}};var xr=y(Q(),1);var zd="m1cvfiap",Wd="f1nz04q2",Hd="syo0l7n",jd="w9541mz",_d="e73gufq";var Rt=y(w(),1),wm=["left","right","auto-vertical"];function Kd({controlKey:r,nodeId:o}){let e=C(),t=()=>{e.stores.modalStore.dismiss()},n=at(()=>{let p=e.stores.treeStore.tree.get(o);return!$e(p)&&!Ae(p)?null:p},[o],["Tree"]),i=at(()=>{let f=e.tree.getScopeNodeFor(n);return f?os(f):null},[n],["Tree"]),a=at(()=>{if($e(n)){let f=n?.parentid,p=e.stores.treeStore.tree,h=p.getNodeWithTrait(f,_t);if(!h)return null;let I=h.getPropertyControls(p,e.componentLoader)[r];return I?.type==="richtext"?I:null}if(Ae(n)){let f=e.componentLoader.reactComponentForIdentifier(n.codeComponentIdentifier);if(!f)return null;let p=f.properties[r];return p?.type==="richtext"?p:null}return null},[r,n],["Tree","ActiveBundle"]),s=(0,xr.useMemo)(()=>{if(!n)return"";let f=kn(e.componentLoader,n,r);return f?oo(e,f):""},[n,r]),l=!!i&&!!n&&a?.type==="richtext",d=f=>{if(!n)return;let p=e.stores.treeStore.tree.current(n);if(!p)return;let h=e.tree.root.getLocale(e.stores.routeStore.localeId);if(h.id!==X){if($e(p)){let g=p.getControlProp(r);if(!g||g.type!=="richtext")return;let F=dt(e,g)?.value??g.value;if(!V(F)){e.stores.modalStore.dismiss();return}ye.updateLocalizedValue(e,p,r,F,f,h,"rich-text");return}if(Ae(p)){let g=kn(e.componentLoader,p,r);if(!g||!V(g.value)){e.stores.modalStore.dismiss(),e.exitTool();return}ro(e,p,g.value,f,h,v=>Co(v,r,void 0),"rich-text");return}}let c,I=kn(e.componentLoader,n,r);I?c={...I,value:f}:c={type:"richtext",value:f},$e(p),p.setControlProp(r,c),m(ba(e),"Only on-page engine can commit tree"),e.stores.projectStore.commitTreeAndSend()};(0,xr.useEffect)(()=>{l||e.stores.modalStore.dismiss()},[l]);let u=pr(()=>It(Xi(n)?jo:la));return l?(0,Rt.jsxs)(qt,{visible:!0,hasBackdrop:!0,onDismiss:t,className:zd,formClassName:Wd,children:[(0,Rt.jsx)(Gt,{separator:!0,title:a.title??"Unknown",className:jd,children:(0,Rt.jsx)(Yt,{onDismiss:t})}),(0,Rt.jsx)(_a,{className:Hd,children:(0,Rt.jsx)(gr,{enabled:!0,schema:u,className:_d,defaultValue:s,onChange:d,scopeType:i,onUnsavedChange:$t,popoverAttachmentEdge:wm,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0})})]}):null}function kn(r,o,e){if($e(o)){let t=o.getControlProp(e);return t?.type==="richtext"&&V(t.value)?t:null}if(Ae(o)){let t=r.reactComponentForIdentifier(o.codeComponentIdentifier);if(!t)return null;let i=o.getControlProps(t.properties)[e];if(i?.type==="richtext"&&V(i.value))return i}return null}var vo=y(w(),1),Cm={AcquireAddonModal:null,AcquireAdvancedAnalyticsTrialModal:null,AddToLibrary:null,BatchTranslate:null,CodeFileCreation:null,CompleteSignup:null,ComponentIsolationModal:null,Confirmation:Al,ConfirmationPlugin:null,ConfirmBatchTranslateAll:null,ConfirmDefaultLanguage:null,ConfirmDeleteCollectionItems:null,ConfirmDeleteCustomCode:null,ConfirmDestructiveFeedbackAction:null,ConfirmDraftCollectionItem:null,ConfirmDraftLocale:null,ConfirmDraftPage:null,ConfirmHideAllInThisLocale:null,ConfirmPublishAbTest:null,ConfirmPublishDraftCollectionItem:null,ConfirmPublishDraftLocale:null,ConfirmPublishDraftPage:null,ConfirmRemoveTriggerEvent:null,ConfirmUpdatingAbVariants:null,ConvertToCMSPage:null,ConvertToKitPage:null,CreateAbTest:null,CreateComponent:null,CreateLayoutTemplate:null,CreateManagedCollection:null,CreateTeam:null,CustomBreakpoint:null,EmbeddedCheckout:null,DashboardAddHeader:null,DashboardAddRedirect:null,DashboardAddRewrite:null,DashboardEditHeader:null,DashboardEditRedirect:null,DashboardEditRewrite:null,DashboardRequestProjectAccess:null,DeleteCodeFile:null,DeleteCustomFont:null,DeleteEntityFolder:null,DeleteFile:null,DeleteMultipleCodeFiles:null,DeleteMultipleEntityFolders:null,DeprecatedDrafts:null,DuplicateProjectWithVersion:null,DuplicateWebPage:null,EditCustomCode:null,EditVector:null,FigmaImportTutorial:null,FlexToYearly:null,ImageCrop:Dl,ImageFocalPoint:Rl,ImportFigma:null,ImportRedirects:null,LoadingFullDocument:null,LocaleReady:null,LocaleSettings:null,LocalizationGlossary:null,None:null,NudgePreferences:null,OnPageCMSFieldsModal:Dd,OnPageRichTextEditor:Kd,OnPageRichTextVariantOverride:Vd,OverrideFile:null,PasteFromFigma:null,PlanCancellation:null,PluginFromURL:null,PluginWithModePicker:null,PublishModule:null,QuickActions:null,RemoveTeamLibraryModule:null,ReplaceTextStylePreset:null,ReplaceWebPage:null,RequestControl:null,SelectProjectToUpgrade:null,Shortcuts:null,StopAbTest:null,SubscriptionNotInOrder:null,TransferProject:null,Templates:null,UnlinkComponent:null,UnsavedChanges:null,UnsupportedFileSize:null,UnsupportedFileType:null,UpgradeDocument:null,UpsellEnterprise:null,UpsellFeature:null,Variables:null,VectorImport:null,VectorSetCreation:null,VectorSetUnlink:null,ViewCustomCode:null,Welcome:null,KitRemix:null};function qd(){let o=C().stores.modalStore.useState(e=>e.stack);return o.map((e,t)=>{if(e.type==="None")return null;let n=Cm[e.type];m(n,`Modal is missing: ${e.type}`);let{type:i,...a}=e,s=t===o.length-1,l=e.type+t;return(0,vo.jsx)(Va,{allowFocusTrap:s,children:(0,vo.jsx)(qa.Provider,{value:Xs(i),children:(0,vo.jsx)(Ka.Provider,{value:s?"visible":"hidden",children:(0,vo.jsx)(n,{...a})})})},l)})}function Yd({accessStore:r,routeStore:o},e){let t=r.access;m(t.status==="success","Can't open Framer if project access is not successful");let n=e??o.projectLinkNodeId,i=`${Ro().app}/projects/${t.data.projectSlug}?node=${n}`;window.open(`https://www.framer.com/open-in-app?url=${encodeURIComponent(i)}`,"_blank")}var ec=y(Q(),1);var $d="t49i6vy",Bt="bjwo6qr",no="b1qwl3y9",Xd="m1wta5up",Zd="m69kutt",On="sdjdrec",Jd="l9efojb";var Mn={slug:!0,string:!0,richtext:!0,link:!0,image:!0,array:!0,multicollectionreference:!0,collectionreference:!0,file:!0,date:!0,number:!0,boolean:!0,enum:!0,color:!0};function Pr(r){return il(r).flatMap(t=>{let n=t.type;return Mn[n]!==void 0?t.id:[]})}var E=y(w(),1);function tc(){let r=C(),{routeStore:o,treeStore:e,canvasStore:t,projectStore:n,modalStore:i}=r.stores,a=P(()=>r.stores.canvasStore.finishedEditing,[]),{hasPermanentlyFailed:s}=n.useState(),l=a?.isNewItem?"Page saved":"Site saved",d=Od(),u=Md(),f=(0,ec.useCallback)(()=>{m(u,"Collection node must exist"),m(d,"Collection item node must exist");let c=Pr(u);r.exitTool(),i.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:c,requiredFieldsOnly:!1,source:"on_page_hud",collectionItemId:d.id,collectionNodeId:u.id})},[o,e,i,r,d,u]),p=()=>{i.set({type:"Confirmation",title:"Discard Changes",description:"All changes will be lost. This action cannot be undone.",confirmLabel:"Discard",cancelLabel:"Cancel",variant:"destructive",source:"on_page_hud",onConfirm:()=>{t.discardTemporaryCollectionItem()}})},h=!!d?.privateToUserId;return(0,E.jsx)(E.Fragment,{children:(0,E.jsxs)("div",{className:$d,children:[h?(0,E.jsxs)(K,{className:q(Bt,no),onClick:p,children:[(0,E.jsx)(Ra,{}),"Discard Page"]}):(0,E.jsx)(Pm,{finishedEditing:a}),(0,E.jsxs)("div",{className:Xd,children:[(0,E.jsx)(Qd,{desktopText:"Click to edit",mobileText:"Tap to edit",secondaryText:"Changes are auto-saved",isVisible:!a}),(0,E.jsx)(Qd,{desktopText:l,mobileText:l,secondaryText:`A notification was sent to your collaborators. ${a?.isNewItem?"The page":"Changes"} will be visible when the project is published.`,isVisible:!!a})]}),(0,E.jsxs)(ve,{direction:"row",gap:10,children:[u&&!h&&!u.managedByPlugin&&!a&&(0,E.jsxs)(K,{className:q(Bt,no),enabled:!s,onClick:()=>t.createTemporaryCollectionItem(),"aria-label":"Add Page",children:[(0,E.jsx)(Oa,{}),(0,E.jsx)(vr,{desktopText:"Add Page",mobileText:"Page"})]}),h&&!s&&(0,E.jsxs)(K,{className:q(Bt,no),onClick:f,children:[(0,E.jsx)(Fm,{}),"Show All Fields"]}),a?(0,E.jsxs)(K,{className:q(Bt,no),onClick:()=>t.handleDismissFinishEditing(),children:[(0,E.jsx)(vm,{}),"Go Back to Site"]}):(0,E.jsxs)(K,{variant:"primary",className:Bt,onClick:()=>t.handleFinishEditing(),children:[(0,E.jsx)(Da,{"aria-hidden":"true"}),(0,E.jsx)(vr,{desktopText:"Finish Editing",mobileText:"Done"})]})]})]})})}function Qd({desktopText:r,mobileText:o,secondaryText:e,isVisible:t}){return(0,E.jsx)(Di,{children:t&&(0,E.jsxs)(Ye.div,{className:Zd,initial:{marginTop:10,opacity:0},animate:{marginTop:0,opacity:1},exit:{marginTop:-10,opacity:0},children:[(0,E.jsx)(vr,{desktopText:r,mobileText:o}),(0,E.jsx)("span",{className:On,children:"\xB7"}),(0,E.jsx)("span",{className:On,children:e})]})})}function vr({desktopText:r,mobileText:o}){let e=ll(`(max-width: ${Ea.tabletSmall}px)`);return!o&&e?null:(0,E.jsx)("span",{children:e?o:r})}function Pm({finishedEditing:r}){let o=C(),e=()=>{Yd(o.stores,r?.isNewItem?r.nodeId:void 0)};return(0,E.jsxs)(K,{className:q(Bt,no),onClick:e,"aria-label":"Open in Framer",children:[(0,E.jsx)(Ba,{"aria-hidden":"true",className:Jd}),(0,E.jsx)(vr,{desktopText:"Open in Framer"})]})}function vm(){return(0,E.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"9",fill:"none",children:[(0,E.jsx)("path",{d:"M 1.5 7.5 L 8 1",fill:"transparent",strokeWidth:"1.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),(0,E.jsx)("path",{d:"M 3 1 L 8 1 L 8 6",fill:"transparent",strokeWidth:"1.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]})}function Fm(){return(0,E.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"11",height:"11",fill:"none",children:[(0,E.jsx)("path",{d:"M1 5.5s1.5-3 4.5-3 4.5 3 4.5 3-1.5 3-4.5 3-4.5-3-4.5-3Z",fill:"transparent",strokeWidth:"1.5",stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round"}),(0,E.jsx)("path",{d:"M5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z",fill:"#fff"})]})}var Le=class extends G{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,Et)||this.engine.tree.getNodeWithTrait(this.nodeId,S)}getVariableInfo(){let e=this.getNode();if(!e)return;let t=ln(e);if(!t)return;let n=e.cache.getRenderInstance(this.renderId);if(n)return M(this.engine.tree,this.engine.componentLoader,this.engine.stores.treeStore.sandboxRepeaterData,t,"collectionreference",n.repeaterItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,controlProp:i}=t;i.value!==e&&n.setControlProp(t.variableDefinition.id,{...i,value:e})}static supportsNode(e,t,n){let i=ln(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,i,"collectionreference",a.repeaterItemId):!1}};var bm=["string","richtext","image","responsiveimage"],Ve=class r extends G{constructor(e,t,n){super(e);this.nodeId=t;this.renderId=n}getCodeComponentNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,Ae)}getEditableControls(){let e=this.getCodeComponentNode();if(e)return r.getEditableControls(this.engine,e,this.renderId)}update(){let e=this.engine,t=this.getCodeComponentNode();(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}stop(){let{modalStore:e}=this.engine.stores;e.stack.some(({type:n})=>n==="OnPageRichTextEditor")&&e.dismissAll()}static getEditableControls(e,t,n){let i=e.stores.routeStore.localeId,s=Xe(e.tree,i).id!==X&&Oe("onPageLocalizationSupport"),l=t.cache.getRenderInstance(n);if(!l)return Ao();let d=e.componentLoader.reactComponentForIdentifier(t.codeComponentIdentifier);if(!d)return Ao();let u=t.getControlProps(d.properties);if(!u)return Ao();let f=[],p=ma(e.stores.modulesStore,e.tree,t.codeComponentIdentifier);if(ji(t)&&p&&!s)if(_i(t)){let h=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,t.dynamicVectorSetIdentifier,"vectorsetitem",l.repeaterItemId);h&&f.push({type:"collection",controlKey:"dynamicVectorSetIdentifier",variableInfo:h})}else Si(t.codeComponentIdentifier)&&f.push({type:"vectorSetItem",codeComponentIdentifier:t.codeComponentIdentifier});for(let h in u){let c=u[h];if(!c||s&&!bm.includes(c.type))continue;let I=d.properties[h];if(I){if(c.type==="enum"&&ht.isOn("onPageEnumVariableOnComponentInstanceEditTool")&&!me(c.value)){m(I.type==="enum");let g=xt(I);m(g,"Reduced control prop should not be null"),Ct(g,c,I),f.push({type:"component",controlKey:h,controlDescription:I,controlProp:c,reducedControlProp:g})}if(c.type==="string"){if(L(c.value)){let g=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,c.value,c.type,l.repeaterItemId);if(!g)continue;let v=g.controlProp,F=null;s&&nn(v)&&(F=dt(e,v)),f.push({type:"collection",controlKey:h,variableInfo:g,localizedValue:F})}else if(!me(c.value)){m(I.type==="string");let g=xt(I);m(g,"Reduced control prop should not be null"),Ct(g,c,I);let v=null;s&&nn(c)&&(v=dt(e,c)),f.push({type:"component",controlKey:h,controlDescription:I,controlProp:c,reducedControlProp:g,localizedValue:v})}}if(c.type==="richtext"){if(L(c.value)){let g=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,c.value,c.type,l.repeaterItemId);if(!g)continue;f.push({type:"collection",controlKey:h,variableInfo:g})}else if(!me(c.value)){m(I.type==="richtext");let g=xt(I);m(g,"Reduced control prop should not be null"),Ct(g,c,I),f.push({type:"component",controlKey:h,controlDescription:I,controlProp:c,reducedControlProp:g})}}if(c.type==="image"){if(L(c.value)){let g=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,c.value,c.type,l.repeaterItemId);if(!g)continue;f.push({type:"collection",controlKey:h,variableInfo:g})}else if(!me(c.value)){m(I.type==="image"||I.type==="responsiveimage");let g=xt(I);m(g,"Reduced control prop should not be null"),Ct(g,c,I),f.push({type:"component",controlKey:h,controlDescription:I,controlProp:c,reducedControlProp:g})}}if(c.type==="date"){if(L(c.value)){let g=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,c.value,"date",l.repeaterItemId);if(!g)continue;f.push({type:"collection",controlKey:h,variableInfo:g})}else if(!me(c.value)){m(I.type==="date");let g=xt(I);m(g,"Reduced control prop should not be null"),Ct(g,c,I),f.push({type:"component",controlKey:h,controlDescription:I,controlProp:c,reducedControlProp:g})}}if(c.type==="vectorsetitem"){if(L(c.value)){let g=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,c.value,"vectorsetitem",l.repeaterItemId);if(!g)continue;f.push({type:"collection",controlKey:h,variableInfo:g})}else if(!me(c.value)){m(I.type==="vectorsetitem");let g=xt(I);m(g,"Reduced control prop should not be null"),Ct(g,c,I),f.push({type:"component",controlKey:h,controlDescription:I,controlProp:c,reducedControlProp:g})}}if(c.type==="link"){if(L(c.value)){let g=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,c.value,"link",l.repeaterItemId);if(!g)continue;f.push({type:"collection",controlKey:h,variableInfo:g})}else if(!me(c.value)){m(I.type==="link");let g=xt(I);m(g,"Reduced control prop should not be null"),Ct(g,c,I),f.push({type:"component",controlKey:h,controlDescription:I,controlProp:c,reducedControlProp:g})}}if(c.type==="boolean"&&L(c.value)){let g=M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,c.value,"boolean",l.repeaterItemId);if(!g)continue;f.push({type:"collection",controlKey:h,variableInfo:g})}}}return f}static supportsNode(e,t,n){return Ae(t)?r.getEditableControls(e,t,n).length>0:!1}};var ze=class r extends G{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,S)}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=r.getVariableReference(e);if(n)return M(this.engine.tree,this.engine.componentLoader,this.engine.stores.treeStore.sandboxRepeaterData,n,"date",t.repeaterItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;a.value!==e&&(n.setControlProp(i.id,{...a,value:e}),this.engine.stores.projectStore.commitTreeAndSend())}update(){let e=this.engine,t=this.getRichTextNode();(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}static getVariableReference(e){let t=e.textContent;if(!Mo(t))return;let n=t.startValue;if(L(n))return n}static supportsNode(e,t,n){if(!S(t))return!1;let i=r.getVariableReference(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,i,"date",a.repeaterItemId):!1}};var We=class r extends G{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,S)}static getVariableReference(e){let t=e.textContent;if(!Mo(t))return;let n=t.startValue;if(L(n))return n}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=r.getVariableReference(e);if(n)return M(this.engine.tree,this.engine.componentLoader,this.engine.stores.treeStore.sandboxRepeaterData,n,"enum",t.repeaterItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;a.value!==e&&(n.setControlProp(i.id,{...a,value:e}),this.engine.stores.projectStore.commitTreeAndSend())}static supportsNode(e,t,n){if(!S(t))return!1;let i=r.getVariableReference(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,i,"enum",a.repeaterItemId):!1}};var He=class r extends G{constructor(e,t,n){super(e);this.nodeId=t;this.renderId=n}update(){let e=this.engine,t=e.tree.get(this.nodeId);(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}getImageSource(){let e=this.engine.stores.treeStore,t=e.tree.getNodeWithTrait(this.nodeId,Et);if(!t)return;let n=Me(this.engine,t,ls);if(Xt(n))return n;if(!L(t.fillImage))return;let i=t.cache.getRenderInstance(this.renderId),a=M(e.tree,this.engine.componentLoader,e.sandboxRepeaterData,t.fillImage,"image",i?.repeaterItemId);R(a,"Variable info must exist");let{collectionItemNode:s}=a,l=Me(this.engine,s,()=>wt(s.id,a.variableId));return Xt(l)?l:void 0}static supportsNode(e,t,n){if(!Et(t))return!1;if(L(t.fillImage)){let i=t.cache.getRenderInstance(n);return i?!!M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,t.fillImage,"image",i.repeaterItemId):!1}return!Mi(t.fillImage)}};var oc,rc,Fr,Ln,fe=class extends(rc=G,oc=[A()],rc){constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.onCancelWithoutMove=i;T(this,Ln,x(Fr,8,this,!1)),x(Fr,11,this);U(this,"beginState",null);U(this,"beginStates",new Map);U(this,"previousInsertionIndex");U(this,"handleKeyDown",()=>{});U(this,"endingMoveTool",!1);U(this,"state");let{mouseStore:a}=this.engine.stores,s=e.tree.get(this.nodeId);R(s,"Node must exist"),this.beginState=fs(e.tree,e.componentLoader,s,a.canvasMousePosition),this.beginStates.set(s,this.beginState),this.listenForEscapeKey()}listenForEscapeKey(){this.handleKeyDown=e=>{if(e.key==="Escape"){let t=Vo(this.beginState?.parent)?this.beginState.parent.getChildrenInVisualOrder().findIndex(n=>n.id===this.nodeId):-1;this.previousInsertionIndex=t,e.preventDefault(),e.stopPropagation(),this.endMoveTool()}},window.addEventListener("keydown",this.handleKeyDown)}endMoveTool(){this.hasMoved?this.commitMove():this.onCancelWithoutMove()}update(){if(this.endingMoveTool)return;let{treeStore:e,mouseStore:t,canvasStore:n,routeStore:i}=this.engine.stores,a=e.tree.get(this.nodeId);if(!a)return this.endMoveTool();let s=ce({screenWidth:n.screenWidth,tree:e.tree,webPageNodeId:i.webPageNodeId});if(!t.isMouseDown||!s){this.endMoveTool(),this.endingMoveTool=!0;return}let d=e.tree,u=t.canvasMousePosition;R(this.beginState,"beginState must be defined"),R(Vo(this.beginState.parent),"parent must be a stack or grid component");let f=re.subtract(u,this.beginState.canvasPointUnderMouse);if(this.hasMoved=f.x!==0||f.y!==0,!this.hasMoved)return;let p=this.getPlaceholder(a,this.beginState.parent);if(!p)return;let h=this.beginState.rect,c=re.add(h,f),g=a.cache.getRenderInstance(this.renderId)?.parentRenderId??this.beginState.parent.id,v=d.convertPointToCanvas(this.beginState.parent,c,void 0,void 0,g);this.state={renderId:this.renderId,nodeId:this.nodeId,rect:{height:p.attributes.height,left:v.x,top:v.y,width:p.attributes.width},placeholder:p}}stop(){window.removeEventListener("keydown",this.handleKeyDown)}commitMove(){let{treeStore:e}=this.engine.stores,t=e.tree.get(this.nodeId);if(!t){this.state=void 0,this.engine.exitTool();return}let n=Vo(this.beginState?.parent)?this.beginState.parent.getChildrenInVisualOrder().findIndex(i=>i.id===t.id):-1;this.state=void 0,this.beginState?.parent&&Io(this.previousInsertionIndex)&&this.previousInsertionIndex!==n&&(this.engine.tree.moveNode(t,this.beginState.parent.id,this.previousInsertionIndex),this.engine.stores.projectStore.commitTreeAndSend()),setTimeout(()=>{this.engine.exitTool()},50)}getPlaceholder(e,t){if(!e)return null;let n=this.engine.tree.getRect(e,void 0,void 0,void 0,this.renderId),a=e.cache.getRenderInstance(this.renderId)?.parentRenderId??t.id,s={width:n.width,height:n.height},l=cs(this.engine.tree,this.engine.stores.treeStore.layoutCache,this.engine.stores.mouseStore.canvasMousePosition,this.engine.stores.mouseStore.previous.canvasMousePosition,this.beginStates,t,this.engine.tree.convertPointToNode(t,this.engine.stores.mouseStore.canvasMousePosition,void 0,a),this.previousInsertionIndex);return s&&Io(l)&&t?(this.previousInsertionIndex!==l&&(this.previousInsertionIndex=l),{nodeId:t.id,attributes:s,index:l}):null}static supportsNode(e,t){if(zi(t))return!1;let n=t.parentid?e.tree.get(t.parentid):null;return!(!n?.children||!ht.isOn("onPageMoveTool")||!dn(t)||e.stores.canvasStore.temporaryCollectionItemNodeId||e.tree.isGroundNode(n)||!(n.children.reduce((l,d)=>l+(dn(d)?1:0),0)>1))}};Fr=te(rc),Ln=new WeakMap,b(Fr,4,"hasMoved",oc,fe,Ln),oe(Fr,fe);var Be=class r extends G{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;this.engine.beginUndoGroup();let a=this.getRichTextNode();m(a,"Missing rich text node");let s=ir(this.engine.tree,a);ut.loadFonts(s).catch(ie)}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,S)}getVariableReference(){let e=this.getRichTextNode();if(!e)return;let t=e.textContent;if(L(t))return t}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=this.getVariableReference();if(n)return M(this.engine.tree,this.engine.componentLoader,this.engine.stores.treeStore.sandboxRepeaterData,n,"string",t.repeaterItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}getValue(){let e=this.getVariableInfo();if(!e)return;let{controlProp:t}=e;return m(t,"Control prop must exist"),oo(this.engine,t,"text")}changeValue(e){let t=this.getVariableInfo(),n=this.getRichTextNode();if(m(n,"Rich text node must exist"),!t)return;let{collectionItemNode:i,variableDefinition:a,controlProp:s}=t;if(m(s,"Control prop must exist"),this.engine.tree.root.getLocale(this.engine.stores.routeStore.localeId).id!==Kt)Cr(this.engine,t,e,n);else{if(s.value===e)return;i.setControlProp(a.id,{...s,value:e})}this.engine.stores.projectStore.commitTreeAndSend()}update(){let e=this.engine,t=this.getRichTextNode();if(!t||!r.supportsNode(e,t,this.renderId))e.exitTool();else{let n=this.getVariableInfo();this.engine.stores.toolStore.validateCollectionControl(n)}}stop(){this.engine.endUndoGroup(),this.engine.stores.toolStore.nodeInTextEditorId=null}static supportsNode(e,t,n){if(!S(t)||!L(t.textContent))return!1;let i=t.cache.getRenderInstance(n);return i?!!M(e.tree,e.componentLoader,e.stores.treeStore.sandboxRepeaterData,t.textContent,"string",i.repeaterItemId):!1}};var ke=class r extends G{update(){let o=this.engine,{routeStore:e,canvasStore:t,treeStore:n,mouseStore:i,toolStore:a}=o.stores,s=ce({screenWidth:t.screenWidth,tree:n.tree,webPageNodeId:e.webPageNodeId});if(!s||i.isHoveringFloatingCanvasChrome)return;if(i.isHoveringChrome){a.highlightedRenderId=void 0;return}let l=n.tree,d=i.canvasMousePosition,u=l.getNodeRendersAtPoint(s,d,!0),f=xa(u,l),h=f.filter(g=>r.isLockedOrBlockedByAnOverlappedLockedLayer(o,g.node,g.renderId)||r.isInteractiveNodeOrTopLevelRepeaterNode(o,g.node,g.renderId)).at(-1);if(h){o.stores.toolStore.highlightedRenderId=h.renderId;return}let I=f.filter(g=>r.isUnexpectedlyNonInteractiveNode(o,g.node,g.renderId)).at(-1);if(I){a.highlightedRenderId=I.renderId;return}a.highlightedRenderId=void 0}static isInteractiveNodeOrTopLevelRepeaterNode(o,e,t){return r.isInteractiveNode(o,e,t)||br(o,e)}static isHighlightableNode(o,e,t){return r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t)?!1:Ve.supportsNode(o,e,t)||ze.supportsNode(o,e,t)||He.supportsNode(o,e,t)||ue.supportsNode(o,e)||ye.supportsNode(o,e,t)||Be.supportsNode(o,e,t)||Le.supportsNode(o,e,t)||We.supportsNode(o,e,t)}static isNodeSupported(o,e,t){return Ve.supportsNode(o,e,t)||ze.supportsNode(o,e,t)||He.supportsNode(o,e,t)||ue.supportsNode(o,e)||ye.supportsNode(o,e,t)||Be.supportsNode(o,e,t)||Le.supportsNode(o,e,t)||We.supportsNode(o,e,t)||fe.supportsNode(o,e)}static isInteractiveNode(o,e,t){return r.isNodeSupported(o,e,t)&&!r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t)}static isUnexpectedlyNonInteractiveNode(o,e,t){return r.isNodeSupported(o,e,t)?r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t):da(e)||Ae(e)}static isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t){if(!ht.isOn("onPageLockedLayers"))return!1;if(fn(e)&&r.isNodeSupported(o,e,t))return!0;let n=ce({screenWidth:o.stores.canvasStore.screenWidth,tree:o.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});if(!n)return!1;let i=o.tree.getCornerPointsOnCanvasWithZoom(e,1),a=re.centroid(i);return[...i,a].every(d=>{let u=o.tree.getNodesAtPoint(n,d),f=$o(u,o.tree).reverse();for(let p of f){if(fn(p)&&r.isNodeSupported(o,p,t))return!0;if(p.id===t)return!1}})}};function br(r,o){return!(!Wi(o)||Qs(r.tree,o)||Lo(r.tree.getWebPageNodeFor(o)))}var sc=y(Q(),1);var nc="ci35ri5",ic="suurpvn",ac="s1xlu29h";var Sr=y(w(),1),lc=(0,sc.memo)(function(){let o=C(),e=P(()=>o.stores.editableNodeHighlightStore.editableNodesHighlight,[]);return e?(0,Sr.jsx)(Ye.div,{className:q(nc,ic),initial:{"--radius":`${e.minRadius}px`},animate:{"--radius":`${e.maxRadius}px`},transition:{duration:e.animationDuration/1e3,ease:"easeOut"},style:{top:e.minY,height:e.maxY-e.minY,"--x":`${e.originX}px`,"--y":`${e.originY}px`,"--gradient-size":`${e.gradientSize}px`},children:(0,Sr.jsx)("div",{style:{position:"absolute",top:-e.minY},children:e.highlights.map(t=>(0,Sr.jsx)("div",{className:ac,style:{width:t.width,height:t.height,transform:t.transform,transformOrigin:"top left"}},t.renderId))})},e.animationId):null});var dc="h1czcor4";var mc=y(Q(),1);var cc=y(Q(),1),fc=y(w(),1),Z=(0,cc.forwardRef)(function({tree:o,node:e,renderId:t,style:n,overrideRect:i,...a},s){let l=C(),d=P(()=>{if(i)return i;let f=l.stores.treeStore.domLayoutUpdate,p=o.getRect(e,void 0,void 0,void 0,t);return{width:p.width,height:p.height,x:0,y:0}},[o,e,t,i],Ne.equals),u=o.transformMatrixToNode(e,void 0,void 0,t);return(0,fc.jsx)("div",{...a,ref:s,style:{position:"absolute",width:d.width,height:d.height,top:d.y,left:d.x,transformOrigin:"top left",transform:u.toString(),...n}})});var Vn=y(w(),1);function pc({tool:r}){let{renderId:o}=r,e=ge(),t=C(),n=t.tree,i=(0,mc.useRef)(null),a=r.getNode();if(Qt(i,()=>{t.exitTool()}),!!a&&e)return(0,Vn.jsx)(Z,{ref:i,tree:n,node:a,renderId:o,children:(0,Vn.jsx)(Pl,{tool:r,node:a,renderId:o,scopeNode:e})})}var uc="v1r7rm12";var Tr=y(w(),1);function Tm(r){return r.message}function Er({validationWarning:r}){if(!r)return null;let o=Tm(r);return(0,Tr.jsxs)("div",{className:uc,children:[(0,Tr.jsx)(Ma,{width:10,height:10}),o]})}var Fo=y(w(),1);function gc({tool:r}){let{nodeId:o,renderId:e}=r,t=C(),n=P(()=>t.stores.toolStore.validationWarning,[]),i=P(()=>t.stores.treeStore.tree,[]),a=P(()=>t.stores.toolStore.editorOverlayClipPath,[]),s=ge(),l=P(()=>t.stores.toolStore.proseMirror,[]),d=i.getNodeWithTrait(o,S);if(!d||!s||!l)return;function u(f){f.target===f.currentTarget&&t.exitTool()}return(0,Fo.jsxs)(Z,{tree:i,node:d,renderId:e,children:[(0,Fo.jsx)(Er,{validationWarning:n}),(0,Fo.jsx)(Sl,{tool:r,scopeNode:s,node:d,renderId:e,proseMirror:l,zoom:1,onClickOutside:u,hasValidationWarning:!!n,style:{clipPath:a}})]})}var io=y(Q(),1);var hc="p6dts5z",yc="pcmqzkm";var Nr="nbqylm8",Ic="v1pcr3uc",zn="p1mivvux",Uc="t42x8tu",wc="g1atul0u",Cc="n1i0g06w",xc="b1t4nog5",Pc="r1wgs7ug",vc="rsrrcv7",Fc="rckttk2",bc="r12nxotj",Sc="r460cpk",Ec="rrb252f",Tc="rxpkzma",Nc="c1ct4jl9";var k=y(w(),1),Am=["bottom","top","right","left"],Dm={x:pe.values.inputSpacing,y:pe.values.inputSpacing};function Rm(r){return r.controlProp.type==="string"}function Dc({tool:r}){let[o,e]=(0,io.useState)(null),t=C(),n=t.stores.modalStore.useState(h=>h.active.type!=="None"),[i,a]=(0,io.useState)(!1);!i&&n&&a(!0);let s=P(()=>t.stores.treeStore.tree,[]),l=s.getNodeWithTrait(r.nodeId,Gi),d=(0,io.useMemo)(()=>{let h=s;return r.getEditableControls()},[r,s]);function u(){t.exitTool()}let f=l?.id,p=(0,io.useMemo)(()=>f?[f]:[],[f]);if(!(!l||!d||d.length===0))return(0,k.jsx)(Z,{tree:s,node:l,ref:e,renderId:r.renderId,className:Nr,children:(0,k.jsx)(Xo,{anchor:o,alignSelf:"center",attachTo:Am,offset:Dm,onClose:u,showArrow:!0,arrow:{anchor:o,alignSelf:"center"},fallbackToModalAppearance:!0,backdropTintEnabled:!1,className:q(hc,n&&yc),focusTrapEnabled:!n,animateAppear:!i,zIndex:21,children:(0,k.jsx)(vl,{displayDivider:!0,title:Om(t.componentLoader,l),onClose:u,children:(0,k.jsx)(ve,{gap:0,paddingTop:pe.css.inputSpacing,paddingBottom:pe.css.inputSpacing,paddingLeft:pe.css.panelPadding,paddingRight:pe.css.panelPadding,children:d.map(h=>{switch(h.type){case"vectorSetItem":return(0,k.jsx)(Ml,{nodeIds:p,supportsVariables:!1,dynamicVectorSetIdentifier:void 0,codeComponentIdentifier:h.codeComponentIdentifier});case"component":return(0,k.jsx)(km,{editableControl:h,node:l,nodeIds:p});case"collection":return(0,k.jsx)(Bm,{editableControl:h,nodeIds:p,node:l});default:jt(h)}})})})})})}function Bm({editableControl:r,nodeIds:o,node:e}){let{variableInfo:t,localizedValue:n}=r,i=C(),{controlProp:a,controlDescription:s,collectionItemNode:l,variableDefinition:d,reducedControlProp:u,variableId:f}=t;switch(a.type){case"string":{m(s.type==="string"),m(u.type==="string");let p;return n&&(p={...u,value:n.value}),(0,k.jsx)(Po,{nodeIds:o,controlKey:d.id,control:s,controlProp:p??u,onChange:(h,c)=>{m(a.type==="string");let I=i.tree.root.getLocale(i.stores.routeStore.localeId),g=c(a);if(I.id!==X){if(!V(g.value)||!Rm(t)){i.exitTool();return}Cr(i,t,g.value,e)}else{if(ae(g,a))return;l.setControlProp(h,g),i.stores.projectStore.commitTreeAndSend()}}},r.controlKey)}case"enum":return m(s.type==="enum"),m(u.type==="enum"),(0,k.jsx)(xo,{controlKey:d.id,control:s,controlProp:u,onChange:(p,h)=>{m(p.type==="enum"),!ae(p,a)&&(l.setControlProp(h,p),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"richtext":return m(s.type==="richtext"),m(u.type==="richtext"),(0,k.jsx)(mr,{title:s.title||Oo(d.id),children:(0,k.jsx)(K,{title:"Edit Content",className:un,onClick:()=>{i.stores.modalStore.set({type:"OnPageRichTextEditor",controlKey:d.id,nodeId:l.id,source:"on_page_hud"})}})},r.controlKey);case"image":{if(m(s.type==="responsiveimage"),m(u.type==="responsiveimage"),!e)return null;let p=i.tree.root.getLocale(i.stores.routeStore.localeId);if(p.id!==X){let h=Me(i,e,()=>wt(l.id,f));return Xt(h)?(0,k.jsx)(Rc,{title:s.title??"Unknown",controlKey:r.controlKey,activeLocale:p,source:h}):null}return(0,k.jsx)(yn,{nodeIds:o,controlKey:d.id,control:s,controlProp:u,onChange:(h,c)=>{m(a.type==="image");let I=c(a);ae(I,a)||(l.setControlProp(h,I),i.stores.projectStore.commitTreeAndSend())},onUpload:async(h,c)=>{let I=await h;I&&(l.setControlProp(c,{type:"image",value:I}),i.stores.projectStore.commitTreeAndSend())}},r.controlKey)}case"date":return m(s.type==="date"),m(u.type==="date"),(0,k.jsx)(gn,{controlKey:d.id,control:s,controlProp:u,onChange:(p,h)=>{m(p.type==="date"),m(a.type==="date"),!ae(p,a)&&(l.setControlProp(h,p),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"link":return m(s.type==="link"),m(u.type==="link"),(0,k.jsx)(Un,{controlKey:d.id,control:s,controlProp:u,onChange:(p,h)=>{m(a.type==="link");let c=h(a);ae(c,a)||(l.setControlProp(p,c),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"boolean":return m(s.type==="boolean"),m(u.type==="boolean"),(0,k.jsx)(ur,{nodeIds:o,controlKey:d.id,control:s,controlProp:u,onChange:(p,h)=>{m(p.type==="boolean"),m(a.type==="boolean"),!ae(p,a)&&(l.setControlProp(h,p),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"vectorsetitem":return m(s.type==="vectorsetitem"),m(u.type==="vectorsetitem"),(0,k.jsx)(In,{controlKey:d.id,control:s,controlProp:u,onChange:(p,h)=>{m(p.type==="vectorsetitem"),m(a.type==="vectorsetitem"),!ae(p,a)&&(l.setControlProp(h,p),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);default:jt(a)}}function km({editableControl:r,nodeIds:o,node:e}){let t=C();switch(r.controlDescription.type){case"string":{m(r.reducedControlProp.type==="string");let n=r.localizedValue,i;return n&&(i={...r.reducedControlProp,value:n.value}),(0,k.jsx)(Po,{nodeIds:o,controlKey:r.controlKey,control:r.controlDescription,controlProp:i??r.reducedControlProp,onChange:(a,s)=>{m(r.controlProp.type==="string");let l=s(r.controlProp),d=t.tree.root.getLocale(t.stores.routeStore.localeId);if(d.id!==X){if(!V(l.value)||!V(r.controlProp.value)){t.exitTool();return}ro(t,e,r.controlProp.value,l.value,d,u=>Co(u,a,void 0))}else{if(ae(l,r.controlProp))return;e.setControlProp(a,l),t.stores.projectStore.commitTreeAndSend()}}},r.controlKey)}case"enum":return m(r.reducedControlProp.type==="enum"),(0,k.jsx)(xo,{controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{m(r.controlProp.type==="enum"),!ae(n,r.controlProp)&&(e.setControlProp(i,n),t.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"richtext":return m(r.reducedControlProp.type==="richtext"),(0,k.jsx)(mr,{title:r.controlDescription.title??"Unknown",children:(0,k.jsx)(K,{title:"Edit Content",className:un,onClick:()=>{t.stores.modalStore.set({type:"OnPageRichTextEditor",controlKey:r.controlKey,nodeId:e.id,source:"on_page_hud"})}})},r.controlKey);case"image":case"responsiveimage":{if(m(r.reducedControlProp.type==="image"||r.reducedControlProp.type==="responsiveimage"),!e)return null;let n=t.tree.root.getLocale(t.stores.routeStore.localeId);if(n.id!==X){let i=Me(t,e,a=>Co(a,r.controlKey,void 0));return Xt(i)?(0,k.jsx)(Rc,{title:r.controlDescription.title??"Unknown",controlKey:r.controlKey,activeLocale:n,source:i}):null}return(0,k.jsx)(yn,{nodeIds:o,controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(i,a)=>{m(r.controlProp.type==="image");let s=a(r.controlProp);ae(s,r.controlProp)||(e.setControlProp(i,s),t.stores.projectStore.commitTreeAndSend())},onUpload:async(i,a)=>{let s=await i;if(!s)return;m(r.controlProp.type==="image");let l=Bl(r.controlProp,s);e.setControlProp(a,l),t.stores.projectStore.commitTreeAndSend()}},r.controlKey)}case"date":return m(r.reducedControlProp.type==="date"),(0,k.jsx)(gn,{controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{m(n.type==="date"),!ae(n,r.controlProp)&&(e.setControlProp(i,n),t.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"link":return m(r.reducedControlProp.type==="link"),(0,k.jsx)(Un,{controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{m(r.controlProp.type==="link");let a=i(r.controlProp);ae(a,r.controlProp)||(e.setControlProp(n,a),t.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"vectorsetitem":return m(r.reducedControlProp.type==="vectorsetitem"),(0,k.jsx)(In,{controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{m(n.type==="vectorsetitem"),!ae(n,r.controlProp)&&(e.setControlProp(i,n),t.stores.projectStore.commitTreeAndSend())}},r.controlKey);default:jt(r.controlDescription)}}function Rc({title:r,controlKey:o,activeLocale:e,source:t}){let n=C(),i=n.tree.root.locales;m(i,"Locales must exist");let a=Xe(n.tree,e.id),{imageValue:s,imageFallback:l,handleImageUpload:d,updateAssetSize:u,imagePositionX:f,imagePositionY:p,handleFocalPointChange:h,clearImage:c}=hr(n,t,e,i,"on-page-image-edit-tool"),I=t.localizedValues[e.id],g=yt(a,t.localizedValues),v=I?.value,F=g?.value??t.value;return(0,k.jsxs)(mr,{title:r??Oo(o),children:[(0,k.jsx)(kl,{title:r??Oo(o),imageReference:s??l??"",previewDimmed:!s,onChange:d,onChangeAssetSize:u,positionX:f,positionY:p,onChangeFocalPosition:h,altText:v??"",onChangeAltText:N=>it(n,N,t,e,{trackingSource:"on-page-image-edit-tool"}),altTextPlaceholder:F||void 0}),(0,k.jsx)(K,{title:"Clear",onClick:c,style:{width:"100%"}})]})}function Om(r,o){let e=r.reactComponentForIdentifier(o.codeComponentIdentifier);return e?e.name:"Component"}var Ar=y(Q(),1);var Wn=y(w(),1);function Bc({tool:r}){let{nodeId:o,renderId:e}=r,t=C(),n=t.tree,i=(0,Ar.useRef)(null),a=ge(),s=n.getNodeWithTrait(o,S);if(Qt(i,()=>{t.exitTool()}),(0,Ar.useEffect)(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"})),!!s&&a)return(0,Wn.jsx)(Z,{ref:i,tree:n,node:s,renderId:e,children:(0,Wn.jsx)(Fl,{tool:r,scopeNode:a,node:s,renderId:e,backdropEnabled:!0})})}var kc=y(Q(),1);var Hn=y(w(),1);function Oc({tool:r}){let{nodeId:o,renderId:e}=r,t=C(),n=t.tree,i=(0,kc.useRef)(null),a=ge(),s=n.getNodeWithTrait(o,S);if(Qt(i,()=>{t.exitTool()}),!!s&&a)return(0,Hn.jsx)(Z,{ref:i,tree:n,node:s,renderId:e,children:(0,Hn.jsx)(bl,{tool:r,node:s,renderId:e,scopeNode:a})})}var kt=y(Q(),1);var le=y(w(),1);function Lc(){let r=C(),o=P(()=>r.stores.treeStore.tree,[]),e=P(()=>r.stores.toolStore.highlightedRenderId,[]),t=P(()=>r.stores.mouseStore.lastUpdateType==="scroll",[]),n=P(()=>r.stores.mouseStore.isHoveringFloatingCanvasChrome,[]),i=ki("onPageQuickAddRepeaterItems"),a=At(e),s=o.get(a),l=Qr(s),d=!Pe(e),u=(0,kt.useMemo)(()=>{if(!i||!s||!e)return null;if(br(r,s))return s;let F=s.ancestors();for(let N of F)if(br(r,N))return N;return null},[s,e,i]),f=l&&d,p=f&&!t&&ke.isHighlightableNode(r,s,e),h=f&&ke.isUnexpectedlyNonInteractiveNode(r,s,e),c=f&&!h&&!n&&ke.isInteractiveNode(r,s,e),I=!!u&&!t,g=Lm({highlightedNode:s,highlightedRenderId:e,engine:r}),v=zm(s,e);return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(Mm,{notAllowedCursor:h}),f&&(0,le.jsxs)(le.Fragment,{children:[c&&(0,le.jsx)(Z,{tree:o,node:s,renderId:e,className:q(Nr,!p&&Ic,g),onMouseDown:v}),I&&(0,le.jsx)(Wm,{tree:o,highlightedRenderId:e,repeaterNode:u})]})]})}function Mm(r){let o=C(),e=(0,kt.useCallback)(()=>{o.stores.editableNodeHighlightStore.highlight(o,{type:"clickOnVoid"})},[]);return(0,le.jsx)("div",{"aria-hidden":!0,className:q(xc,r.notAllowedCursor&&Cc),onClick:e})}function Lm({highlightedNode:r,highlightedRenderId:o,engine:e}){let t=Qr(r),n=!Pe(o);return!t||!n?zn:ue.supportsNode(e,r)||ye.supportsNode(e,r,o)||Be.supportsNode(e,r,o)?Uc:fe.supportsNode(e,r)?wc:zn}var Vm=r=>{switch(r){case"top":return vc;case"bottom":return Fc;case"left":return bc;case"right":return Sc}};function zm(r,o){let e=C();return(0,kt.useCallback)(()=>{!r||!o||(fe.supportsNode(e,r)?e.startMoveTool(r.id,o,()=>{Mc(e,r,o)||e.startHighlightTool()}):Mc(e,r,o))},[r,o])}function Mc(r,o,e){return Ve.supportsNode(r,o,e)?(r.startComponentInstanceEditTool(o.id,e),!0):ze.supportsNode(r,o,e)?(r.startDateVariableEditTool(o.id,e,"mouse"),!0):He.supportsNode(r,o,e)?(r.startImageEditTool(o.id,e),!0):ue.supportsNode(r,o)?(r.startRichTextEditTool(o.id,e,"mouse"),!0):ye.supportsNode(r,o,e)?(r.startRichTextVariableEditTool(o.id,e,"mouse"),!0):Be.supportsNode(r,o,e)?(r.startStringVariableEditTool(o.id,e,"mouse"),!0):Le.supportsNode(r,o,e)?(r.startCollectionReferenceVariableEditTool(o.id,e,"mouse"),!0):We.supportsNode(r,o,e)?(r.startEnumVariableEditTool(o.id,e,"mouse"),!0):(r.stores.editableNodeHighlightStore.highlight(r,{type:"clickOnVoid"}),!1)}function Wm(r){let o=C(),{mouseStore:e}=o.stores,{tree:t,highlightedRenderId:n,repeaterNode:i}=r,a=P(()=>e.canvasMousePosition,[],en),s=P(()=>o.stores.treeStore.domLayoutUpdate,[],en),l=(0,kt.useMemo)(()=>{if(!i)return;let u=ca(t,i);if(!u)return;let f=u.cache.domRects,p=null;for(let[h,c]of f??[])p=p?Ne.merge(p,c):c;if(p)return p},[t,i,s]),d=(0,kt.useMemo)(()=>{let u="bottom";if(!i)return u;let f=Li(i)&&i.stackDirection==="horizontal"&&!i.stackWrapEnabled,p=t.convertFrameToCanvas(i,l,n);if(f){let N=p.x,_=N+p.width,ne=window.scrollX,je=ne+window.innerWidth,_e=N>=ne&&N<=je,Ee=_>=ne&&_<=je;if(_e&&!Ee)return"left";if(Ee&&!_e)return"right";if(_e&&Ee){let ft=a.x-N,mt=_-a.x;return ft<mt?"left":"right"}return"right"}let h=p.y,c=h+p.height,I=window.scrollY,g=I+window.innerHeight,v=h>=I&&h<=g,F=c>=I&&c<=g;if(v&&!F)return"top";if(F&&!v)return"bottom";if(v&&F){let N=a.y-h,_=c-a.y;return N<_?"top":"bottom"}return u},[i,n,l,a,t.convertFrameToCanvas]);return i?(0,le.jsx)(Z,{tree:t,node:i,renderId:n,className:Nc,overrideRect:l,children:(0,le.jsxs)("button",{type:"button",className:q(Ec,Vm(d)),onMouseDown:()=>Hm(o,i.id),[Cn]:"true",children:[(0,le.jsx)(La,{className:Tc,children:(0,le.jsx)(Aa,{})}),(0,le.jsx)("div",{className:Pc})]})}):null}function Hm(r,o){let{treeStore:e,projectStore:t,modalStore:n,accessStore:i}=r.stores,a=e.tree.getNodeWithTrait(o,tn),s=tn(a)&&Lo(a)?aa(e.tree,a.dataIdentifier):void 0,l=i.access?.userId;m(l,"User must be logged in"),m(s,"Collection node must exist");let d=Go.create({isDraft:!0,privateToUserId:l});fr(s,d),e.tree.insertNode(d,s.id,0),t.commitTreeAndSend(),n.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:Pr(s),requiredFieldsOnly:!1,source:"on_page_hud",collectionNodeId:s.id,collectionItemId:d.id})}var Ie=y(Q(),1);var Vc="pqnmppj";var Ue=y(w(),1),_m=["right","left"],Km={x:15,y:0};function zc({tool:r}){let{nodeId:o,renderId:e}=r,[t,n]=(0,Ie.useState)(null),i=C(),a=i.stores.routeStore.localeId,s=i.tree.root.getLocale(a),l=s.id!==X&&Oe("onPageLocalizationSupport"),d=P(()=>i.stores.treeStore.tree,[]),u=d.getNodeWithTrait(o,Et);function f(){i.exitTool()}if(!u)return;let p=l?r.getImageSource():void 0;return(0,Ue.jsx)(Z,{tree:d,node:u,renderId:e,ref:n,children:(0,Ue.jsxs)(Xo,{anchor:t,alignSelf:"center",attachTo:_m,offset:Km,onClose:f,showArrow:!0,arrow:{anchor:t,alignSelf:"center"},fallbackToModalAppearance:!0,backdropTintEnabled:!1,children:[(0,Ue.jsx)(Ya,{disableDivider:!0,onClose:f,children:(0,Ue.jsx)($a,{title:"Image"})}),(0,Ue.jsx)("div",{className:Vc,children:p?(0,Ue.jsx)(qm,{activeLocale:s,source:p}):me(u.fillImage)?(0,Ue.jsx)(Gm,{node:u,dynamicValue:u.fillImage,renderId:e}):(0,Ue.jsx)($m,{node:u,tree:d})})]})})}function qm({activeLocale:r,source:o}){let e=C(),t=e.tree.root.locales,n=Xe(e.tree,r.id);m(t,"Locales must exist");let{imageValue:i,imageFallback:a,handleImageUpload:s,updateAssetSize:l,imagePositionX:d,imagePositionY:u,handleFocalPointChange:f}=hr(e,o,r,t,"on-page-image-edit-tool"),p=o.localizedValues[r.id],h=yt(n,o.localizedValues),c=p?.value??"",I=h?.value??o.value,g=i??a??"";return I===""&&(I="Empty Alt Text"),(0,Ue.jsx)(gl,{altText:c,altTextPlaceholder:I,onChangeAltText:v=>{v===""?Ms(e,o,r,{target:"default",trackingSource:"on-page-image-edit-tool"}):v!==c&&it(e,v,o,r,{trackingSource:"on-page-image-edit-tool"})},imageReference:g,onChange:s,onChangeAssetSize:l,positionX:d,positionY:u,onChangeFocalPosition:f})}function Gm({node:r,dynamicValue:o,renderId:e}){return m(L(o),"Expected variable reference"),(0,Ue.jsx)(Ym,{node:r,variableReference:o,renderId:e})}function Ym({node:r,variableReference:o,renderId:e}){let t=C(),n=P(()=>{let u=t.stores.treeStore,f=r.cache.getRenderInstance(e);return M(u.tree,t.componentLoader,u.sandboxRepeaterData,o,"image",f?.repeaterItemId)},[r,e,o]);m(n,"Variable info must exist");let{collectionItemNode:i,reducedControlProp:a,controlProp:s}=n;m(a.type==="responsiveimage","Expected reduced responsive image");let l=(0,Ie.useCallback)(u=>{i.set(rn({[o.id]:u(s)})),t.stores.projectStore.commitTreeAndSend()},[i,o,s]),d=(0,Ie.useCallback)(()=>{i.set(rn({[o.id]:{type:"image",value:void 0}})),t.stores.projectStore.commitTreeAndSend()},[i,o]);return(0,Ue.jsx)(hl,{controlProp:a,onChange:l,onRemove:d,maxExtraImages:0})}function $m({node:r,tree:o}){let e=C(),t=(0,Ie.useMemo)(()=>{let f={...Zs(),...el()};return Js(o,r,f),tl(r,f),f},[r,o]),n=(0,Ie.useCallback)(async f=>{let[p]=await f;p&&(Os(r,p),e.stores.projectStore.commitTreeAndSend())},[r]),i=(0,Ie.useCallback)(f=>{V(r.fillImage)&&(r.set({fillImage:Qi(r.fillImage,f)}),e.stores.projectStore.commitTreeAndSend())},[r]),a=(0,Ie.useCallback)(f=>{fa(r)&&(r.set({altAttribute:f}),e.stores.projectStore.commitTreeAndSend())},[r]),s=(0,Ie.useCallback)(f=>{r.set({fillImageResize:f}),e.stores.projectStore.commitTreeAndSend()},[r]),l=(0,Ie.useCallback)(f=>{r.set({fillImageTileSize:f}),e.stores.projectStore.commitTreeAndSend()},[r]),d=(0,Ie.useCallback)((f,p)=>{r.set({fillImagePositionX:f,fillImagePositionY:p}),e.stores.projectStore.commitTreeAndSend()},[r]),u=(0,Ie.useCallback)(()=>{r.set({fillImage:void 0}),e.stores.projectStore.commitTreeAndSend()},[r]);return(0,Ue.jsx)(ml,{...t,imageReferences:t.fillImages,altText:t.altAttribute,onChangeImages:n,onChangeAssetSize:i,onChangeAltText:a,onChangeImageResize:s,onChangeFillImageSize:l,onChangeImagePosition:d,onRemoveImage:u})}var Wc="g189l9ii",Hc="m1va6tk8";var _c=y(w(),1);function jc({tool:r}){let o=C(),e=P(()=>r.hasMoved,[r]),t=P(()=>o.stores.treeStore.tree,[]),n=t.get(r.nodeId);if(!n)return null;let i=t.get(n.parentid);if(!i)return null;let s=n.cache.getRenderInstance(r.renderId)?.parentRenderId??i.id;return(0,_c.jsx)(Z,{tree:t,node:i,renderId:s,className:q(e&&Hc,e&&Wc)})}var Gc=y(Q(),1);var Kc="w1uyyr5z",qc="w1z0oe1i";var bo=y(w(),1);function Yc({richTextNode:r,webPageNode:o}){let e=C(),t=P(()=>e.stores.treeStore.tree,[]);return(0,Gc.useMemo)(()=>{let i=t.getNodeWithTrait(r.getPrimaryId(),S);return m(i,"originalNode must exist"),o.getTopLevelReplicaVariants().some(a=>{let s=wo(a.id,i.id),l=t.get(s);return S(l)&&qo(t,l,"html")&&l.getTextContent()!==i.getTextContent()})},[t,r,o])?(0,bo.jsxs)(Na,{className:Kc,onClick:()=>{e.exitTool(),e.stores.modalStore.set({richTextNodeId:r.id,source:"on_page_hud",type:"OnPageRichTextVariantOverride"})},children:[(0,bo.jsx)(ka,{viewBox:"0 0 12 12",className:qc}),(0,bo.jsx)(rt,{children:"Responsive Text"})]}):null}var $c="w1v62ead";var ao=y(w(),1);function Xc({tool:r}){let{nodeId:o,renderId:e}=r,t=C(),n=P(()=>t.stores.treeStore.tree,[]),i=P(()=>t.stores.toolStore.editorOverlayClipPath,[]),a=P(()=>t.stores.toolStore.proseMirrorView,[]),s=n.getNodeWithTrait(o,S),l=ge();return!s||!l||!a?null:(0,ao.jsxs)(Z,{tree:n,node:s,renderId:e,children:[(0,ao.jsx)("div",{className:$c,children:(0,ao.jsx)(Yc,{richTextNode:s,webPageNode:l})}),(0,ao.jsx)(El,{tool:r,scopeNode:l,node:s,renderId:e,editorView:a,zoom:1,handleOutsideClick:d=>{d.target===d.currentTarget&&t.exitTool()},style:{clipPath:i}})]})}var So=y(w(),1);function Zc({tool:r}){let{nodeId:o,renderId:e}=r,t=C(),n=P(()=>t.stores.treeStore.tree,[]),i=P(()=>t.stores.toolStore.validationWarning,[]),a=P(()=>t.stores.toolStore.editorOverlayClipPath,[]),s=n.getNodeWithTrait(o,S),l=ge();return!l||!s?null:(0,So.jsxs)(Z,{tree:n,node:s,renderId:e,children:[(0,So.jsx)(Er,{validationWarning:i}),(0,So.jsx)(Tl,{tool:r,scopeNode:l,node:s,renderId:e,zoom:1,onClickOutside:d=>{d.target===d.currentTarget&&t.exitTool()},hasValidationWarning:!!i,style:{clipPath:a}})]})}var de=y(w(),1);function Jc(){let r=C(),{sandboxStore:o}=r.stores,{canvasHeight:e}=o.useState(),t=P(()=>Yo.get(r.stores.treeStore.tree),[]);return(0,de.jsxs)("div",{className:dc,style:{height:e??"initial"},children:[(0,de.jsx)(lc,{}),(0,de.jsx)(Qm,{}),(0,de.jsx)($s,{componentLoader:r.componentLoader,presetsListNode:t})]})}function Qm(){let r=C(),{projectStore:o,modalStore:e}=r.stores,t=P(()=>r.stores.toolStore.tool,[]),n=P(()=>r.stores.canvasStore.finishedEditing,[]),{hasPermanentlyFailed:i}=o.useState(),a=e.useState(s=>s.active.type!=="None");if(!i&&!n&&!a){if(t instanceof fe)return(0,de.jsx)(jc,{tool:t});if(t instanceof ke)return(0,de.jsx)(Lc,{});if(t instanceof He)return(0,de.jsx)(zc,{tool:t});if(t instanceof ue)return(0,de.jsx)(Xc,{tool:t});if(t instanceof ye)return(0,de.jsx)(gc,{tool:t});if(t instanceof Be)return(0,de.jsx)(Zc,{tool:t});if(t instanceof ze)return(0,de.jsx)(Bc,{tool:t});if(t instanceof Le)return(0,de.jsx)(pc,{tool:t});if(t instanceof We)return(0,de.jsx)(Oc,{tool:t});if(t instanceof Ve)return(0,de.jsx)(Dc,{tool:t})}}var Qe=y(w(),1);function Qc(){eo();let r=C(),o=P(()=>r.stores.canvasStore.isHidden,[]);return(0,Dr.useEffect)(()=>{let e=({data:t})=>{if(gt(t)&&t.apiVersion===1){let{type:n,position:i}=t;n==="showCanvas"&&gt(i)&&Io(i.top)&&(window.scrollTo({behavior:"instant",top:i.top}),setTimeout(()=>{r.stores.canvasStore.isHidden=!1,r.startHighlightTool(),r.stores.editableNodeHighlightStore.highlight(r,{type:"start"})},0))}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]),(0,Dr.useEffect)(()=>{let{sandboxStore:e}=r.stores;o?e.hide():e.show()},[o]),ep(o),Ql({channel:Ei,toast:Ut}),(0,Qe.jsx)(Wa,{children:(0,Qe.jsxs)("div",{className:q(o&&ad),children:[(0,Qe.jsx)(Jc,{}),(0,Qe.jsxs)("div",{className:sd,[wn]:"true",children:[(0,Qe.jsx)(tc,{}),(0,Qe.jsx)(qd,{}),(0,Qe.jsx)(Qa,{padding:80}),(0,Qe.jsx)(Zl,{ref:r.stores.projectStore.filePickerRef})]})]})})}function ep(r){let o=C();(0,Dr.useEffect)(()=>{if(r)return;let e=new fl;e.set("CommandOrControl+Z",o.undo.bind(o),"undo"),e.set("CommandOrControl+Shift+Z",o.redo.bind(o),"redo");function t(n){if(ar())return;let i=e.get(n);i&&(Re("keyboard_shortcut",{shortcut:cl(n)}),i.action(n),n.preventDefault(),n.stopPropagation())}return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[r])}var ef=y(Q(),1);function tf(){(0,ef.useEffect)(()=>{let r=o=>{if(!gt(o.data))return;let{apiVersion:e,type:t}=o.data;e===1&&t==="enterOnPageEditing"&&Re("editor_bar_interaction",{page:"editor-bar-project-page",id:"editor-bar-enter-on-page-editing"})};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)},[])}var Yn=y(Q(),1);var so="https://app.framerstatic.com/framer-logo-blue-UQOIW3P5.png";var Br="b9jl8lf",kr="eptse9g";var of="bzafg2a",rf="cnhgigm",nf="t1ookr3o",af="tyol4w7",sf="s7fryoi",lf="by9jupw",df="b18g1n4a",cf="c1gc3a0q";var lo=y(w(),1);function ff({width:r=10,height:o=10,className:e}){return(0,lo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:o,fill:"none",className:e,"aria-hidden":"true",children:(0,lo.jsxs)("g",{transform:"translate(2 2)",children:[(0,lo.jsx)("path",{d:"M 0 0 L 6 6",fill:"transparent",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),(0,lo.jsx)("path",{d:"M 0 6 L 6 0",fill:"transparent",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})})}var we=y(w(),1);function rp({children:r,onClick:o,disabled:e,layoutId:t,duration:n}){return(0,we.jsx)(Ye.div,{layout:"position",layoutId:t,style:{width:"100%"},transition:{duration:n,type:"spring",bounce:.2,delay:0},children:(0,we.jsx)(K,{type:"button",className:lf,onClick:o,enabled:!e,children:r})})}function co({logo:r,title:o,subtitle:e,buttons:t,showLearnMoreButton:n}){let i=()=>{window.open("https://www.framer.com/help/articles/on-page-editing","_blank")},a=()=>{window.parent.postMessage({apiVersion:1,type:"sandboxReadyState",data:{status:"ready"}},"*"),window.parent.postMessage({apiVersion:1,type:"exitFullscreen",position:{top:window.scrollY}},"*")};return(0,we.jsx)(ve,{className:of,onClick:a,children:(0,we.jsxs)(ve,{className:rf,justifyContent:"center",alignItems:"center",onClick:s=>s.stopPropagation(),children:[(0,we.jsx)(ve,{onClick:a,className:cf,children:(0,we.jsx)(ff,{})}),(0,we.jsxs)(ve,{className:nf,gap:15,alignItems:"center",justifyContent:"center",children:[r,(0,we.jsxs)(ve,{gap:5,alignItems:"center",justifyContent:"center",children:[(0,we.jsx)(Ye.span,{layout:!0,className:af,children:o}),(0,we.jsx)(Ye.p,{layout:!0,className:sf,children:e})]})]}),t||n?(0,we.jsxs)(ve,{className:df,gap:10,children:[n?(0,we.jsx)(rp,{onClick:i,children:"Learn More"}):null,t||null]}):null]})})}var Or=y(w(),1);function mf(){let r=C();Jt("editor_bar_impression",{page:"editor-bar-cookie-prompt"});async function o(){Re("editor_bar_interaction",{page:"editor-bar-cookie-prompt",id:"editor-bar-allow-cookies"});try{await document.requestStorageAccess()}finally{await r.stores.accessStore.refresh()}}return(0,Or.jsx)(co,{logo:(0,Or.jsx)("img",{decoding:"async",width:36,src:so,alt:"Framer Logo"}),title:"Edit Page",subtitle:"Continuing may require granting permissions in a browser dialog.",buttons:(0,Or.jsx)(K,{className:q(Br,kr),onClick:o,variant:"primary",children:"Continue"}),showLearnMoreButton:!0})}var Kn=y(w(),1);function pf({children:r,onClick:o,disabled:e,layoutId:t,duration:n,className:i}){return(0,Kn.jsx)(Ye.div,{layout:"position",layoutId:t,style:{width:"100%"},transition:{duration:n,type:"spring",bounce:.2,delay:0},children:(0,Kn.jsx)(K,{type:"button",className:q(Br,i),onClick:o,enabled:!e,children:r})})}var uf="l4nhz4u";var fo=y(w(),1);function gf(){let r=C(),{isLoginInProgress:o}=r.stores.loginStore.useState();Jt("editor_bar_impression",{page:"editor-bar-guest-page"});async function e(){Re("editor_bar_interaction",{page:"editor-bar-guest-page",id:"editor-bar-login"}),await r.stores.loginStore.login()}return(0,fo.jsx)(co,{logo:(0,fo.jsx)("img",{decoding:"async",width:36,height:36,src:so,alt:"Framer Logo"}),title:"Edit Page",subtitle:"Edit the page directly in the browser, without opening the app.",buttons:(0,fo.jsx)(pf,{onClick:e,disabled:o,className:kr,children:o?(0,fo.jsx)("div",{className:uf,children:(0,fo.jsx)(Xl,{})}):"Continue"}),showLearnMoreButton:!0})}var qn=y(w(),1),ip="Page Edit",ap="To edit, ask the site owner for access to the project",sp="To edit, ask the site owner for content editing permissions";function Gn({reason:r}){return Jt("editor_bar_impression",{page:"editor-bar-no-access-page"}),(0,qn.jsx)(co,{logo:(0,qn.jsx)("img",{decoding:"async",width:36,src:so,alt:"Framer Logo"}),title:ip,subtitle:r==="no-permission"?sp:ap,showLearnMoreButton:!0})}var Eo=y(w(),1);function hf(){let r=C(),{access:o}=r.stores.accessStore.useState();switch(o.status){case"no-auth":return(0,Eo.jsx)(gf,{});case"unknown":return(0,Eo.jsx)(mf,{});case"no-access":return(0,Eo.jsx)(Gn,{reason:"no-access"});case"no-permission":return(0,Eo.jsx)(Gn,{reason:"no-permission"});case"success":case"error":return null;default:jt(o)}}var Ot=y(w(),1);function yf(){let r=C(),{shouldRenderOnPageCanvas:o}=r.stores.accessStore.useState(),e=at(()=>r.stores.routeStore.webPageNodeId,[],[r.stores.routeStore]);return(0,Yn.useEffect)(()=>{e&&r.stores.sandboxStore.waitForInitialLoad(e).then(()=>{window.parent.postMessage({apiVersion:1,type:"sandboxReadyState",data:{status:"ready"}},"*")}).catch(ie)},[e]),(0,Yn.useEffect)(()=>{r.performanceTracker.reportEditorBarReady()}),tf(),(0,Ot.jsxs)(Ot.Fragment,{children:[(0,Ot.jsx)(hf,{}),o&&(0,Ot.jsx)(Qc,{})]})}var If=y(Q(),1);var wf=y(w(),1);function Uf(){let r=C(),o=(0,If.useCallback)(()=>{r.stores.contextMenuStore.close()},[]);return(0,wf.jsx)(Nl,{environment:"onPage",menu:r.stores.contextMenuStore.menu,onClose:o})}var Mr=class{constructor(o){this.engine=o;U(this,"state",0);U(this,"changes",new Fa)}get inRendering(){return this.state===3}render(){if(this.state!==1)return;let o=this.changes,e=this.engine.stores;try{this.state=2,o.has(e.treeStore,e.routeStore)&&Jo(e.treeStore.tree,e.treeStore.layoutCache,e.treeStore.sandboxRepeaterData,e.treeStore.sandboxVisibility,this.engine.componentLoader,this.engine.componentLoader.activeBundleHash,e.routeStore.localeId,void 0,e.routeStore.webPageNodeId),e.toolStore.tool?.update?.(),e.undoRedoManager.processScheduledEndUndoGroup({}),this.state=3,e.sandboxStore.update(),o.signalAllObservers(),Il()}finally{this.state=0}}signalChanges(o){if(this.changes.addChanges(o),this.state!==0)return;this.state=1;let e=this.render.bind(this);setTimeout(e,0),yl()}wrapHandler(o,e){let{projectStore:t}=this.engine.stores;return function(...n){let i=o.apply(this,n);return t.commitTreeAndSend(e!=="nonUserEvent"),i}}process(o,e){this.wrapHandler(o,e)()}processWhenReady(o,e){this.wrapHandler(o,e)()}async processWhenReadyAsync(o,e){return this.wrapHandler(o,e)()}runWhenIdle(o){requestIdleCallback(o)}runWithFullyLoadedTree(o,e){m(e.runInBackground,"Only background tasks are supported in the OnPageEngine for now.");let t=this.engine.tree.getService("loader"),n=()=>{o(),this.engine.stores.projectStore.commitTreeAndSend()};if(!t)return n(),$t;let i=t.prioritizeLoadingAllData({operationName:e.name,operationInBackground:!0,doNotTrack:e.doNotTrack}),a=t.afterAllDataLoaded(n);return()=>{i(),a()}}runBeforeNextFrame(o){requestAnimationFrame(o)}scheduleDocumentUpdateIgnoringUndo(o){throw new Error("Not implemented")}async scheduleWithChangeset(o,e){throw new Error("Not implemented")}};var Lr=class extends De{constructor(e,t,n){super();this.projectStore=e;this.hostnameStore=t;this.siteId=n;U(this,"_access")}get access(){return m(this._access,"Access not initialized"),this._access}get projectId(){return Cf(this.access)}get canEditContent(){let e=this.access;return e.status!=="success"?!1:e.data.permissions?.canEditContent==="on"}get shouldRenderOnPageCanvas(){return xn()&&this.canEditContent}async set(e){if(this._access=e,this.shouldRenderOnPageCanvas){let t=Cf(e);e.userId&&t&&(this.projectStore.loadProject(e.userId,t),this.hostnameStore.loadHostnames(t).catch(ie))}ga.setUserId(e.userId??"null")}async refresh(){let e=await Jl(this.siteId);e.status==="success"&&e.data.projectFeatures&&vs.update({...Ps,...e.data.projectFeatures}),await this.set(e)}},lp=/^(?<name>.+--)?(?<id>[a-z0-9]{20})(?<hash>-[a-z0-9]+)?$/iu;function Cf(r){if(r.status==="success")return lp.exec(r.data.projectSlug)?.groups?.id}var xf,Pf,Mt,$n,Xn;Pf=[A()],xf=[A()];var Lt=class{constructor(o){this.scheduler=o;T(this,$n,x(Mt,8,this,[])),x(Mt,11,this);T(this,Xn,x(Mt,12,this)),x(Mt,15,this);U(this,"assetMap",new Zi)}get assets(){return this._assets}get assetService(){return this._assetService}setAssetService(o){this._assetService=o,Ji(o,e=>{e.assets&&(this._assets=e.assets,this.assetMap.set(e.assets),ut.importCustomFonts(this.assetMap.items(),ht.isOn("customFontGrouping")))})}};Mt=te(null),$n=new WeakMap,Xn=new WeakMap,b(Mt,4,"_assets",Pf,Lt,$n),b(Mt,4,"_assetService",xf,Lt,Xn),oe(Mt,Lt);async function vf(r){return es.post("/edit/notifications/page-edited",r)}var Ff,bf,Sf,Ef,be,Zn,Jn,Qn,ei;Ef=[A()],Sf=[A()],bf=[A()],Ff=[A()];var ct=class{constructor(o,e,t,n,i,a,s,l,d,u){this.scheduler=o;this.componentLoader=e;this.accessStore=t;this.routeStore=n;this.treeStore=i;this.projectStore=a;this.modalStore=s;this.undoRedoManager=l;this.exitTool=d;this.onChangeRoute=u;T(this,Zn,x(be,8,this,!0)),x(be,11,this);T(this,Jn,x(be,12,this,null)),x(be,15,this);T(this,Qn,x(be,16,this,window.innerWidth)),x(be,19,this);T(this,ei,x(be,20,this)),x(be,23,this);window.addEventListener("resize",()=>{this._screenWidth=window.innerWidth})}get screenWidth(){return this._screenWidth}get temporaryCollectionItemNodeId(){return this._temporaryCollectionItemNodeId}set temporaryCollectionItemNodeId(o){this._temporaryCollectionItemNodeId=o,this.onChangeRoute()}async sendNotification(o){let e=this.accessStore.projectId;m(e,"Project ID must exist");let t=lt({tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId});m(t,"Web page node must exist");let n=Je(this.routeStore,this.treeStore,this),i;if(n){let a=to(this.routeStore,this.treeStore,this);m(a,"Collection item exists, so its parent collection must exist");let s=a.resolveValue("name");m(s,"Collection node must have a name"),i={notificationType:o,projectId:e,webPageNodeId:t.id,collectionItemNodeId:n.id,collectionItemTitle:dp(a,n),collectionTitle:s,pageType:"cms-detail"}}else i={notificationType:o,projectId:e,webPageNodeId:t.id,pageTitle:t.webMetadata?.title||ns(this.treeStore.tree,this.componentLoader,t),pageType:"static"};await vf(i)}createTemporaryCollectionItem(){let o=to(this.routeStore,this.treeStore,this);if(!o)return;let e=this.accessStore.access?.userId;m(e,"User must be logged in");let t=o.getPrivateItemForUser(e);if(t)this.temporaryCollectionItemNodeId=t.id;else{let n=Go.create({isDraft:!0,privateToUserId:e});this.treeStore.tree.insertNode(n,o.id,0),this.temporaryCollectionItemNodeId=n.id,fr(o,n),this.projectStore.commitTreeAndSend()}}discardTemporaryCollectionItem(){let o=Je(this.routeStore,this.treeStore,this);m(o,"Collection item node must exist"),m(o.id===this.temporaryCollectionItemNodeId,"Collection item must be temporary"),this.treeStore.tree.remove(o.id),this.projectStore.commitTreeAndSend(),this.clearTemporaryItem(),this.exitFullscreen()}saveTemporaryCollectionItem(){let o=Je(this.routeStore,this.treeStore,this);m(o,"Collection item node must exist"),m(o.id===this.temporaryCollectionItemNodeId,"Collection item must be temporary"),o?.set({privateToUserId:void 0}),this.projectStore.commitTreeAndSend(),this.finishEditingWithChanges(o.id,!0)}handleFinishEditing(){this.exitTool();let o=Je(this.routeStore,this.treeStore,this);if(!!!o?.privateToUserId){if(!this.treeStore.hasChanged()){this.handleDismissFinishEditing();return}let l=this.routeStore.projectLinkNodeId;if(!l)return;this.finishEditingWithChanges(l,!1);return}let t=to(this.routeStore,this.treeStore,this);if(m(t&&o,"Collection node and collection item node must exist"),!o.hasData()){this.discardTemporaryCollectionItem();return}let n=sr(t,o);sl(t,o,n)&&this.projectStore.commitTreeAndSend();let s=al(this.treeStore.tree,this.componentLoader,t,o,n).flatMap(l=>{let d=l.type;return Mn[d]!==void 0?l.id:[]});s.length>0?this.modalStore.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:s,requiredFieldsOnly:!0,source:"on_page_hud",collectionItemId:o.id,collectionNodeId:t.id}):this.saveTemporaryCollectionItem()}finishEditingWithChanges(o,e){this.finishedEditing={isNewItem:e,nodeId:o},Re("editor_bar_interaction",{page:"editor-bar-project-page",id:"editor-bar-finish-editing-with-changes"});let t=e?"page-created":"page-edited";this.sendNotification(t).catch(ie)}handleDismissFinishEditing(){this.clearTemporaryItem(),this.undoRedoManager.clearUndoStack(),this.exitFullscreen()}exitFullscreen(){window.parent.postMessage({apiVersion:1,type:"exitFullscreen",position:{top:window.scrollY}},"*"),this.isHidden=!0}clearTemporaryItem(){this.finishedEditing=null,this.temporaryCollectionItemNodeId=void 0}};be=te(null),Zn=new WeakMap,Jn=new WeakMap,Qn=new WeakMap,ei=new WeakMap,b(be,4,"isHidden",Ef,ct,Zn),b(be,4,"finishedEditing",Sf,ct,Jn),b(be,4,"_screenWidth",bf,ct,Qn),b(be,4,"_temporaryCollectionItemNodeId",Ff,ct,ei),oe(be,ct);function dp(r,o){let e=r.getSlugVariable();if(e?.associatedStringVariable){let t=o.getControlProp(e.associatedStringVariable);if(t&&t.type==="string"&&V(t.value)&&t.value.trim())return t.value.trim()}return"a new page"}var Vr=class{constructor(o){this.componentLoader=o}updateComponentLoader(o,e){this.componentLoader.setModuleRevision(e,0);for(let t of o)this.componentLoader.updateEntity(t.identifier,t)}};var cp=0,Tf,zr,ti,po;Tf=[A()];var mo=class{constructor(o){this.scheduler=o;T(this,ti,x(zr,8,this)),x(zr,11,this);T(this,po);window.addEventListener("resize",()=>{this._editableNodesHighlight&&(this._editableNodesHighlight=void 0)})}get editableNodesHighlight(){return this._editableNodesHighlight}onChangeRoute(){this._editableNodesHighlight&&(this._editableNodesHighlight=void 0)}cleanupAnimationOnFinish(o){Ht(this,po)&&clearTimeout(Ht(this,po)),No(this,po,window.setTimeout(()=>{this._editableNodesHighlight=void 0},o+100))}highlight(o,{type:e}){let t=ce({screenWidth:o.stores.canvasStore.screenWidth,tree:o.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});if(!t)return;let n=[],i={x:0,y:window.scrollY,width:window.innerWidth,height:window.innerHeight},a=1/0,s=-1/0,l=!1;for(let d of t.walk())for(let[u]of d.cache.iterateRenderInstances()){if(!ke.isHighlightableNode(o,d,u))continue;l=!0;let f=o.tree.convertFrameToCanvas(d,void 0,u);if(!fp(i,f))continue;a=Math.min(a,f.y),s=Math.max(s,f.y+f.height);let p=o.tree.getRect(d,void 0,void 0,void 0,u),h=o.tree.transformMatrixToNode(d,void 0,void 0,u);n.push({renderId:u,width:p.width,height:p.height,transform:h.toString(),centerX:f.x+f.width/2,centerY:f.y+f.height/2})}if(n.length===0)Ut({key:"editable-nodes-highlight-empty",type:"add",text:l?"Editable content is out of view, scroll to reveal it":"Content is not editable on this page",variant:"info"}),this._editableNodesHighlight=void 0;else{let d=e==="clickOnVoid",u=d?o.stores.mouseStore.windowMousePosition.x:i.width,f=d?o.stores.mouseStore.windowMousePosition.y:i.height/2,p=d?o.stores.mouseStore.canvasMousePosition.y:o.stores.mouseStore.scrollPosition.y,h=400,c=Math.max(u,window.innerWidth-u),I=Math.max(f,window.innerHeight-f),g=Math.sqrt(c**2+I**2)+h,v=Math.max(500,e==="clickOnVoid"?g:g*2),F=5,N=Math.max(0,Math.floor(a-F)),_=Math.ceil(s+F),ne=mp(n,g,u,p);this._editableNodesHighlight={animationId:`editable-nodes-highlight-${cp++}`,minY:N,maxY:_,originX:u,originY:f-N+i.y,highlights:n,minRadius:ne,maxRadius:g,gradientSize:h,animationDuration:v},this.cleanupAnimationOnFinish(v)}}};zr=te(null),ti=new WeakMap,po=new WeakMap,b(zr,4,"_editableNodesHighlight",Tf,mo,ti),oe(zr,mo);function fp(r,o){return!(o.x>=Ne.maxX(r)||Ne.maxX(o)<=r.x||o.y>=Ne.maxY(r)||Ne.maxY(o)<=r.y)}function mp(r,o,e,t){let n=1/0;for(let i of r){let a=Math.sqrt(i.width**2+i.height**2),s=Math.abs(i.centerX-e),l=Math.abs(i.centerY-t),d=Math.sqrt(s**2+l**2),u=Math.max(0,d-a/2);n=Math.min(n,u)}return Number.isFinite(n)&&n<o?n:0}var Wr=class extends ks{constructor(){super(...arguments);U(this,"hostnames");U(this,"testing",{setHostnames:e=>{this.hostnames=e}})}get customHostnameString(){return this.hostnames?.find(e=>e.type==="custom")?.hostname}get defaultHostnameString(){return this.hostnames?.find(e=>e.type==="default")?.hostname}async loadHostnames(e){let{hostnames:t}=await Bs(e);this.hostnames=t}};var Hr=class extends De{constructor(e,t){super();this.componentLoader=e;this.sandboxStore=t}async ensureModuleEvaluatedInSandbox(e){await this.sandboxStore.getModulesRuntime()?.loadModule(e.value)}hasModuleForIdentifier(e){return!!this.componentLoader.componentForIdentifier(e.value)}};var jr=class extends De{constructor(e){super();this.accessStore=e;U(this,"isLoginInProgress",!1)}login(){let e=window.open(`${Ro().login}?closeAfterSuccess=true`,"_blank");return e?this.startLoginWindowClosedPolling(e):Promise.resolve()}startLoginWindowClosedPolling(e){return this.isLoginInProgress=!0,new Promise(n=>{let i=setInterval(async()=>{e.closed&&(clearInterval(i),await this.accessStore.refresh(),this.isLoginInProgress=!1,n())},500)})}};var Nf,Af,Df,Rf,Bf,kf,Of,Mf,Lf,z,oi,ri,ni,ii,ai,si,li,di;Lf=[A()],Mf=[A(re.isEqual)],Of=[A(re.isEqual)],kf=[A()],Bf=[Dt(re.isEqual)],Rf=[A()],Df=[A()],Af=[A()],Nf=[A()];var Ce=class{constructor(o){this.scheduler=o;x(z,5,this);T(this,oi,x(z,8,this)),x(z,11,this);T(this,ri,x(z,12,this,re(0,0))),x(z,15,this);T(this,ni,x(z,16,this,re(0,0))),x(z,19,this);T(this,ii,x(z,20,this,!1)),x(z,23,this);T(this,ai,x(z,24,this,!1)),x(z,27,this);T(this,si,x(z,28,this,!1)),x(z,31,this);T(this,li,x(z,32,this,{canvasMousePosition:re(0,0),windowMousePosition:re(0,0)})),x(z,35,this);T(this,di,x(z,36,this,{canvasMousePosition:re(0,0),windowMousePosition:re(0,0)})),x(z,39,this);let e=this.onMouseMove.bind(this);document.addEventListener("mousemove",e);let t=this.onScroll.bind(this);document.addEventListener("scroll",t);let n=this.onMouseDown.bind(this);document.addEventListener("mousedown",n);let i=this.onMouseUp.bind(this);document.addEventListener("mouseup",i)}get lastUpdateType(){return this._lastUpdateType}get scrollPosition(){return this._scrollPosition}get windowMousePosition(){return this._windowMousePosition}get isMouseDown(){return this._isMouseDown}get canvasMousePosition(){return re.add(this.windowMousePosition,this.scrollPosition)}get isHoveringChrome(){return this._isHoveringChrome}get isHoveringFloatingCanvasChrome(){return this._isHoveringFloatingCanvasChrome}get latest(){return this._latest}get previous(){return this._previous}updateInputState(){this._previous={canvasMousePosition:this._latest.canvasMousePosition,windowMousePosition:this._latest.windowMousePosition},this._latest={canvasMousePosition:this.canvasMousePosition,windowMousePosition:this.windowMousePosition}}onScroll(){this._scrollPosition=re(window.scrollX,window.scrollY),this._lastUpdateType="scroll",this.updateInputState()}onMouseMove(o){this._isHoveringChrome=rd(o.target),this._isHoveringFloatingCanvasChrome=nd(o.target),this._windowMousePosition=re(o.clientX,o.clientY),this._lastUpdateType="mouseMove",this.updateInputState()}onMouseDown(o){this._isMouseDown=!0,this._lastUpdateType="mouseDown",this.updateInputState()}onMouseUp(){this._isMouseDown=!1,this._lastUpdateType="mouseUp",this.updateInputState()}};z=te(null),oi=new WeakMap,ri=new WeakMap,ni=new WeakMap,ii=new WeakMap,ai=new WeakMap,si=new WeakMap,li=new WeakMap,di=new WeakMap,b(z,4,"_lastUpdateType",Lf,Ce,oi),b(z,4,"_scrollPosition",Mf,Ce,ri),b(z,4,"_windowMousePosition",Of,Ce,ni),b(z,4,"_isMouseDown",kf,Ce,ii),b(z,2,"canvasMousePosition",Bf,Ce),b(z,4,"_isHoveringChrome",Rf,Ce,ai),b(z,4,"_isHoveringFloatingCanvasChrome",Df,Ce,si),b(z,4,"_latest",Af,Ce,li),b(z,4,"_previous",Nf,Ce,di),oe(z,Ce);var _r=class extends De{constructor(){super(...arguments);U(this,"colorModel","HEX")}};var Vf=y(Q(),1);var Kr=class extends De{constructor(e,t,n){super();this.componentLoader=e;this.assetStore=t;this.treeStore=n;U(this,"unrecoverableDisconnectReason");U(this,"project");U(this,"projectPromise",new Bo);U(this,"filePickerRef",(0,Vf.createRef)())}get hasPermanentlyFailed(){return!!this.unrecoverableDisconnectReason}getProject(){return this.projectPromise}get resourceLimits(){}get featureFlags(){}get projectLicenseType(){return"freeSite"}loadProject(e,t){eo(),!this.project&&(this.project=new ed(this.treeStore,this.componentLoader,e,t),this.project.connect(),this.project.on("disconnect",this.onDisconnect,this),this.project.connection.on("disconnect",this.onDisconnect,this),this.project.on("update",n=>{this.treeStore.newTreeAfterRemoteUpdate(n)}),this.assetStore.setAssetService(this.project.assetService),this.projectPromise.resolve(this.project))}onDisconnect(e){zs(e)||(this.unrecoverableDisconnectReason=e,e==="ClientNeedsUpdate"?Ut({type:"add",variant:"warning",text:"A new version of Framer is available. Please reload the page to continue working.",key:"client-outdated",duration:1/0,icon:"warning",showCloseButton:"never"}):e==="Maintenance"?Ut({type:"add",variant:"warning",text:"Framer is undergoing maintenance. Please reload to continue once we\u2019re back.",key:"maintenance-mode",duration:1/0,icon:"warning",showCloseButton:"never",action:{title:"Reload",onClick:()=>window.location.reload()}}):Ut({type:"add",variant:"error",text:"Connection error: "+e,key:"connection-error",duration:1/0,icon:"error",showCloseButton:"never"}))}commitTreeAndSend(e=!0){m(this.project,"Project must be initialized"),m(!this.unrecoverableDisconnectReason,`Attempt to commitTreeAndSend after disconnect: ${this.unrecoverableDisconnectReason}`);let t=this.treeStore.timeline.commitLocalTree();this.treeStore.newTreeAfterLocalUpdate(t,e),this.project.maybeSend()}};var zf,Wf,Hf,et,ci,fi,mi;Hf=[A()],Wf=[A()],zf=[A()];var vt=class{constructor(o,e){this.scheduler=o;this.onChangeRoute=e;T(this,ci,x(et,8,this)),x(et,11,this);T(this,fi,x(et,12,this)),x(et,15,this);T(this,mi,x(et,16,this,X)),x(et,19,this);let t=({data:n})=>{if(gt(n)&&n.apiVersion===1){let{type:i,nodeIds:a}=n;if(i==="updateNodeIds"&&gt(a)){let{webPageNodeId:s,collectionItemNodeId:l,activeLocaleId:d}=a;this._webPageNodeId=V(s)?s:void 0,this._collectionItemNodeId=V(l)?l:void 0,this.localeId=V(d)&&Oe("onPageLocalizationSupport")?d:X,this.onChangeRoute()}}};window.addEventListener("message",t),window.parent.postMessage({apiVersion:1,type:"initializeComponent",component:"OnPageActiveRouteStore"},"*")}get collectionItemNodeId(){return this._collectionItemNodeId}get webPageNodeId(){return this._webPageNodeId}get projectLinkNodeId(){return this._collectionItemNodeId??this._webPageNodeId}};et=te(null),ci=new WeakMap,fi=new WeakMap,mi=new WeakMap,b(et,4,"_collectionItemNodeId",Hf,vt,ci),b(et,4,"_webPageNodeId",Wf,vt,fi),b(et,4,"localeId",zf,vt,mi),oe(et,vt);var jf="icxp2h1";var qr=class extends De{constructor(e,t,n,i){super();this.componentsStore=e;this.treeStore=t;this.performanceTracker=n;this.updateGenerator=i;U(this,"config",Ws.onPageCanvas);U(this,"iframe");U(this,"remoteSandbox");U(this,"remoteControlsVisibility");U(this,"remoteModulesRuntime");U(this,"_canvasHeight");U(this,"webPageNodeIdToInitialLoadPromise",new Map);window.addEventListener("scroll",()=>{this.remoteSandbox?.scrollTo({behavior:"instant",top:window.scrollY})})}getControlsVisibility(){return this.remoteControlsVisibility}getModulesRuntime(){return this.remoteModulesRuntime}get canvasHeight(){return this._canvasHeight}loadSandbox(){eo(),m(!this.iframe,"Sandbox already loaded");let e=document.createElement("iframe");e.src=this.config.url,e.allow=Ul("on_page"),e.sandbox.add("allow-scripts","allow-same-origin"),e.tabIndex=-1,e.id="canvas_sandbox",e.className=jf;let t=this.initializeSandbox.bind(this,e);e.addEventListener("load",t),this.iframe=e,this.hide(),document.body.append(e)}getInitialLoadPromise(e){let t=this.webPageNodeIdToInitialLoadPromise.get(e)??new Bo;return this.webPageNodeIdToInitialLoadPromise.set(e,t),t}async waitForInitialLoad(e){this.performanceTracker.reportCanvasLoaderViewed(),await this.getInitialLoadPromise(e)}async initializeSandbox(e){let t=e.contentWindow;m(t,"Sandbox didn't load correctly");let n=new Hs(st);n.setLocal(st.channels.componentsStore,this.componentsStore),n.setLocal(st.channels.sandboxStore,this),n.setLocal(st.channels.treeStore,this.treeStore);let i=n.getRemote(st.channels.sandbox),a=n.getRemote(st.channels.controlsVisibility),s=n.getRemote(st.channels.modulesRuntime),l=n.getRemote(st.channels.flags);await n.connect({target:t,url:this.config.origin}),this.remoteSandbox=i,this.remoteControlsVisibility=a,this.remoteModulesRuntime=s,new js(l)}onHeightChange(e){this._canvasHeight=e}onInitialLoadComplete(e){this.performanceTracker.reportCanvasReady(),this.getInitialLoadPromise(e).resolve()}update(){let e=this.remoteSandbox;if(!e)return;let t=this.updateGenerator.getUpdate();Do(t)||e.update(t)}hide(){m(this.iframe,"Sandbox not loaded"),this.iframe.setAttribute("aria-hidden","true")}show(){m(this.iframe,"Sandbox not loaded"),this.iframe.removeAttribute("aria-hidden")}};var _f,pi;_f=[Dt()];var uo=class{constructor(o,e,t){this.scheduler=o;this.routeStore=e;this.treeStore=t;x(pi,5,this)}get active(){let o=lt({tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId});return R(o,"webPageNode must be defined"),o}};pi=te(null),b(pi,2,"active",_f,uo),oe(pi,uo);function Kf({editorNode:r,screenWidth:o,tree:e,webPageNodeId:t,windowMousePositionOnToolEntry:n}){let i=ce({screenWidth:o,tree:e,webPageNodeId:t});if(!i)return;let a=e.convertFrameToCanvas(r),s=e.getNodesInRect(i,a,!0),l=[],d=i.cache.layoutTemplateRects;if(d)for(let[F,N]of d)!N.canvasRect||!Ne.intersects(N.canvasRect,a)||l.push(new pa({zIndex:N.domRect.zIndex,id:F,parentid:i.id}));let u=s.concat(l),f=$o(u,e,{[i.id]:l}),p=f.findIndex(F=>F.id===r.id);if(p===-1)return;let h=f.slice(p+1);if(h.length===0)return;let I=e.transformMatrixToNode(r).inverse(),g=n?{x:n.x+window.scrollX,y:n.y+window.scrollY,width:1,height:1}:void 0,v=[];for(let F of h){let N=d?.get(F.id),_=e.convertFrameToCanvas(F);if(g&&Ne.intersects(g,_))continue;let ne;if(N?.canvasCorners?ne=N.canvasCorners:ne=e.convertCornerPointsToCanvas(F),ne.length===0)continue;let je=[];for(let{x:_e,y:Ee}of ne){let ft=new DOMPoint(_e,Ee).matrixTransform(I);je.push({x:ft.x,y:ft.y})}je.length!==0&&v.push(je)}if(v.length!==0)return{editorRect:a,polygons:v}}function qf({editorRect:r,polygons:o}){let e=`M ${-Ft},${-Ft} L ${-Ft},${r.height+Ft} L ${r.width+Ft},${r.height+Ft} L ${r.width+Ft},${-Ft} Z`;for(let t of o){let n=t[0];if(!n)continue;let i=[...t,n];for(let a of i)e+=` L ${a.x},${a.y}`;e+=" Z"}return`path("${e}")`}function Gf(r){let o=[];for(let e of r){if(e.length===0)continue;let[t,...n]=e;if(!t)continue;let i=`M ${t.x},${t.y}`;for(let a of n)i+=` L ${a.x},${a.y}`;i+=" Z",o.push(i)}if(o.length!==0)return`path("${o.join(" ")}")`}var Ft=100;var Yf,$f,Xf,Zf,Jf,Qf,em,tm,Y,ui,gi,hi,yi,Ii,go,Ui;tm=[A()],em=[A()],Qf=[A()],Jf=[A()],Zf=[A()],Xf=[A()],$f=[Dt()],Yf=[Dt()];var Se=class{constructor(o,e,t,n,i){this.scheduler=o;this.treeStore=e;this.routeStore=t;this.canvasStore=n;this.mouseStore=i;x(Y,5,this);T(this,ui,x(Y,8,this)),x(Y,11,this);T(this,gi,x(Y,12,this,on)),x(Y,15,this);T(this,hi,x(Y,16,this)),x(Y,19,this);T(this,yi,x(Y,20,this,null)),x(Y,23,this);T(this,Ii,x(Y,24,this)),x(Y,27,this);T(this,go);T(this,Ui,x(Y,28,this)),x(Y,31,this)}get tool(){return this._tool}set tool(o){No(this,go,this.mouseStore.windowMousePosition),this._tool!==o&&(this._tool?.stop?.(),this._tool=o)}get windowMousePositionOnToolEntry(){return Ht(this,go)}get editorClipGeometryEntry(){let o=this.nodeInTextEditorId;if(!o||o===on)return null;let e=At(o),t=this.treeStore.tree.get(e);if(!t)return null;let n=Kf({domLayoutUpdate:this.treeStore.domLayoutUpdate,editorNode:t,screenWidth:this.canvasStore.screenWidth,tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId,windowMousePositionOnToolEntry:Ht(this,go)});return n?{nodeId:e,geometry:n}:null}get editorOverlayClipPath(){let o=this.editorClipGeometryEntry;if(o)return qf(o.geometry)}get sandboxNodeInTextEditorClipPath(){let o=this.editorClipGeometryEntry;if(o)return Gf(o.geometry.polygons)}validateCollectionControl(o){let e="required";if(!o)return;let{collectionItemNode:t,variableDefinition:n,collectionNode:i,controlDescription:a,controlProp:s}=o,l;(zo(n)||Uo(n))&&(l=lr(n,i.variables,t));let d=sr(i,t),u=n.type,f=dr(u,a,s,l,void 0,Wo(n),d.get(n.id));this.validationWarning=f?.type===e?void 0:f}};Y=te(null),ui=new WeakMap,gi=new WeakMap,hi=new WeakMap,yi=new WeakMap,Ii=new WeakMap,go=new WeakMap,Ui=new WeakMap,b(Y,4,"highlightedRenderId",tm,Se,ui),b(Y,4,"nodeInTextEditorId",em,Se,gi),b(Y,4,"proseMirror",Qf,Se,hi),b(Y,4,"proseMirrorView",Jf,Se,yi),b(Y,4,"_tool",Zf,Se,Ii),b(Y,4,"validationWarning",Xf,Se,Ui),b(Y,2,"editorClipGeometryEntry",$f,Se),b(Y,2,"editorOverlayClipPath",Yf,Se),oe(Y,Se);var om,rm,Vt,wi,Ci;rm=[A()],om=[A()];var zt=class{constructor(o,e,t,n){this.scheduler=o;this.componentLoader=e;this.routeStore=t;this.undoRedoManager=n;U(this,"layoutCache",new Es);U(this,"sandboxRepeaterData",new Ts("editor"));U(this,"sandboxVisibility",new Ns("editor"));T(this,wi,x(Vt,8,this,Pa.createWithRouteSegmentRoot())),x(Vt,11,this);T(this,Ci,x(Vt,12,this,0)),x(Vt,15,this);U(this,"timeline");U(this,"treeIndexes",new xi(this));this.timeline=Fs()?new Ss(this.tree,e):new bs(this.tree,e)}get tree(){return this._tree}get domLayoutUpdate(){return this._domLayoutUpdate}get remoteTreeVersion(){return this.timeline.remoteTreeVersion}getChangesForUndo(){let o=this.timeline.getLatestChangesForUndo();return o?o.filter(e=>!e.ignoreInUndo):[]}hasChanged(){return this.undoRedoManager.getUndoBufferSize()>0}getPartialIndexes(){return this.treeIndexes}getLoadedIndexes(){let o=this.tree.getService("loader");if(o){let e=o.numberOfScopesToLoad();throw new Error(`Some scopes are still loading: ${e} scopes left to load`)}return this.treeIndexes}onLayoutMeasure(o){let e=this.layoutCache.processLayoutMeasurements(o);e.size===0||ts(this.tree,this.layoutCache,e).size===0||this._domLayoutUpdate++}onSandboxRendered(o){let e=new Set;if(o.repeaterUpdates){let t=this.sandboxRepeaterData.import(o.repeaterUpdates);for(let n of t){let i=At(n);e.add(i)}}if(o.visibilityUpdates){let t=this.sandboxVisibility.import(o.visibilityUpdates);for(let n of t){let i=At(n);e.add(i)}}if(e.size>0){let t=As(this.tree,e);Jo(this.tree,this.layoutCache,this.sandboxRepeaterData,this.sandboxVisibility,this.componentLoader,this.componentLoader.activeBundleHash,this.routeStore.localeId,void 0,t)}o.layoutMeasurements&&this.onLayoutMeasure(o.layoutMeasurements)}newTreeAfterRemoteUpdate(o){o.inEditor=!0,this._tree!==o&&(this._tree=o)}newTreeAfterLocalUpdate(o,e){if(o.inEditor=!0,this._tree===o)return;this._tree=o;let t=this.getChangesForUndo();e&&t.length>0&&this.undoRedoManager.addUndoEntry({changes:t})}};Vt=te(null),wi=new WeakMap,Ci=new WeakMap,b(Vt,4,"_tree",rm,zt,wi),b(Vt,4,"_domLayoutUpdate",om,zt,Ci),oe(Vt,zt);var xi=class{constructor(o){this.treeStore=o;U(this,"codeComponentNodeCache");U(this,"richTextNodeCache")}get codeComponents(){let o=this.treeStore.tree;if(this.codeComponentNodeCache?.tree===o)return this.codeComponentNodeCache.codeComponentNodes;let e=[];for(let t of o.root.walk())Ae(t)&&e.push(t);return this.codeComponentNodeCache={tree:o,codeComponentNodes:e},e}get richTextNodes(){let o=this.treeStore.tree;if(this.richTextNodeCache?.tree===o)return this.richTextNodeCache.richTextNodes;let e=[];for(let t of o.root.walk())S(t)&&e.push(t);return this.richTextNodeCache={tree:o,richTextNodes:e},e}};var Gr=class extends Ls{};var Yr=class{constructor(o,e,t){U(this,"accessStore");U(this,"assetStore");U(this,"canvasStore");U(this,"componentsStore");U(this,"contextMenuStore");U(this,"editableNodeHighlightStore");U(this,"hostnameStore");U(this,"loadedExternalModulesStore");U(this,"loginStore");U(this,"modalStore");U(this,"modulesStore");U(this,"mouseStore");U(this,"persistedUserDefaults");U(this,"projectStore");U(this,"routeStore");U(this,"sandboxStore");U(this,"scopeStore");U(this,"toolStore");U(this,"treeStore");U(this,"undoRedoManager",new Gr);U(this,"vectorsStore");this.assetStore=new Lt(e),this.editableNodeHighlightStore=new mo(e),this.routeStore=new vt(e,()=>o.onChangeRoute()),this.componentsStore=new Vr(o.componentLoader),this.contextMenuStore=Rs.new(e),this.hostnameStore=Wr.new(e),this.modalStore=va.new(e),this.treeStore=new zt(e,o.componentLoader,this.routeStore,this.undoRedoManager),this.projectStore=Kr.new(e,o.componentLoader,this.assetStore,this.treeStore),this.accessStore=Lr.new(e,this.projectStore,this.hostnameStore,t),this.loginStore=jr.new(e,this.accessStore),this.mouseStore=new Ce(e),this.canvasStore=new ct(e,o.componentLoader,this.accessStore,this.routeStore,this.treeStore,this.projectStore,this.modalStore,this.undoRedoManager,()=>o.exitTool(),()=>o.onChangeRoute()),this.toolStore=new Se(e,this.treeStore,this.routeStore,this.canvasStore,this.mouseStore),this.scopeStore=new uo(e,this.routeStore,this.treeStore),this.sandboxStore=qr.new(e,this.componentsStore,this.treeStore,o.performanceTracker,o.sandboxUpdateGenerator),this.loadedExternalModulesStore=Hr.new(e,o.componentLoader,this.sandboxStore),this.modulesStore=ws.new(e,o.componentLoader,this.treeStore,this.loadedExternalModulesStore,{codeEditorPreviewVisible:!1,mainView:0},this.projectStore.getProject().then(n=>n.modulesAPI),()=>{throw new Error("Can't make document readonly")},async n=>{await this.sandboxStore.getModulesRuntime()?.insertTemporaryImportMap(n)},async()=>{throw new Error("Can't load all local modules")}),this.persistedUserDefaults=_r.new(e),this.vectorsStore=Vs.new(e,this.modulesStore)}};var $r=class{constructor(){U(this,"editorBarReadyAt");U(this,"canvasReadyAt");U(this,"canvasLoaderViewedAt")}get editorBarReadyMs(){let o=up();if(!(Pe(o)||Pe(this.editorBarReadyAt)))return this.editorBarReadyAt-o}get canvasReadyMs(){if(!(Pe(this.canvasReadyAt)||Pe(this.editorBarReadyAt)))return this.canvasReadyAt-this.editorBarReadyAt}get perceivedCanvasLoadMs(){if(!Pe(this.canvasReadyAt))return Pe(this.canvasLoaderViewedAt)?0:Math.min(this.canvasReadyAt-this.canvasLoaderViewedAt,0)}reportEditorBarReady(){this.editorBarReadyAt=Date.now()}reportCanvasLoaderViewed(){this.canvasLoaderViewedAt=Date.now()}reportCanvasReady(){this.canvasReadyAt=Date.now(),this.sendCanvasLoadedEvent()}sendCanvasLoadedEvent(){let{canvasReadyMs:o,editorBarReadyMs:e,perceivedCanvasLoadMs:t}=this;Pe(o)||Pe(e)||Pe(t)||Re("editor_bar_canvas_loaded",{editorBarReadyMs:e,canvasReadyMs:o,perceivedCanvasLoadMs:t})}};function up(){let r=new URLSearchParams(window.location.search).get("loadStart");if(!r)return;let o=Number(r);if(!Number.isNaN(o))return o}var Xr=class{constructor(o){this.engine=o;U(this,"partialTreeSender");U(this,"previousWebPageNodeId");U(this,"previousCollectionItemNodeId");U(this,"previousBreakpointNodeId");U(this,"previousTemporaryCollectionItemNodeId");U(this,"previousStylePresetBreakpointClassNames");U(this,"previousLocalModules");U(this,"previousDependenciesModule");U(this,"previousAssets");U(this,"previousNodeInTextEditor");U(this,"previousNodeInTextEditorClipPath");U(this,"previousMoveToolState");U(this,"previousLocaleId")}getUpdate(){let{canvasStore:o,modulesStore:e,routeStore:t,assetStore:n,treeStore:i,toolStore:a}=this.engine.stores,s={},l=lt({tree:i.tree,webPageNodeId:t.webPageNodeId})?.id;l!==this.previousWebPageNodeId&&(this.previousWebPageNodeId=l,s.webPageNodeId=l);let d=Je(t,i,o)?.id;d!==this.previousCollectionItemNodeId&&(this.previousCollectionItemNodeId=d,s.collectionItemNodeId=d);let u=ce({screenWidth:o.screenWidth,tree:i.tree,webPageNodeId:t.webPageNodeId})?.id;u!==this.previousBreakpointNodeId&&(this.previousBreakpointNodeId=u,s.breakpointNodeId=u);let f=o.temporaryCollectionItemNodeId??null;f!==this.previousTemporaryCollectionItemNodeId&&(this.previousTemporaryCollectionItemNodeId=f,s.temporaryCollectionItemNodeId=f);let p=Yo.get(i.tree),h=gp(p,o.screenWidth);h!==this.previousStylePresetBreakpointClassNames&&(this.previousStylePresetBreakpointClassNames=h,s.stylePresetBreakpointClassNames=h);let c=e.localModules;c!==this.previousLocalModules&&(this.previousLocalModules=c,s.localModules=new Map(c));let I=e.dependenciesModule;I!==this.previousDependenciesModule&&(this.previousDependenciesModule=I,s.dependenciesModule=I);let g=n.assets;g!==this.previousAssets&&(this.previousAssets=g,s.assets=g),this.partialTreeSender??=new _s(i.timeline,"canvas");let v=this.partialTreeSender.update(l);Do(v)||(s.partialTreeUpdate=v);let F=a.nodeInTextEditorId??null;F!==this.previousNodeInTextEditor&&(this.previousNodeInTextEditor=F,s.nodeInTextEditorId=F);let N=a.sandboxNodeInTextEditorClipPath??null;N!==this.previousNodeInTextEditorClipPath&&(this.previousNodeInTextEditorClipPath=N,s.nodeInTextEditorClipPath=N);let _=a.tool instanceof fe?a.tool.state:void 0;return ae(_,this.previousMoveToolState)||(this.previousMoveToolState=_,s.moveToolState=_??null),t.localeId!==this.previousLocaleId&&(this.previousLocaleId=t.localeId,s.activeLocaleId=t.localeId),s}},gp=Oi((r,o)=>{let e=wl(r);return Cl(e,o)});var Zr=class{constructor(o){this.siteId=o;U(this,"name","OnPageEngine");U(this,"componentLoader",new Ti);U(this,"sandboxUpdateGenerator",new Xr(this));U(this,"performanceTracker",new $r);U(this,"scheduler",new Mr(this));U(this,"stores");this.stores=new Yr(this,this.scheduler,o),this.stores.projectStore.getProject().then(e=>{m(this.stores.assetStore.assetService,"assetsService must be initialized"),Cs(this,this.stores.assetStore.assetService,this.stores.projectStore.filePickerRef),rs(e.api,this.stores.assetStore.assetService),this.stores.modulesStore.initialize().catch(ie),e.connection.on("connect",t=>{t&&this.stores.modulesStore.refresh().catch(ie)})})}get tree(){return this.stores.treeStore.tree}getControlsVisibility(){return this.stores.sandboxStore.getControlsVisibility()}startHighlightTool(){this.stores.toolStore.tool=new ke(this)}startComponentInstanceEditTool(o,e){this.stores.toolStore.tool=new Ve(this,o,e)}startDateVariableEditTool(o,e,t){this.stores.toolStore.tool=new ze(this,o,e,t)}startCollectionReferenceVariableEditTool(o,e,t){this.stores.toolStore.tool=new Le(this,o,e,t)}startEnumVariableEditTool(o,e,t){this.stores.toolStore.tool=new We(this,o,e,t)}startImageEditTool(o,e){this.stores.toolStore.tool=new He(this,o,e)}startRichTextEditTool(o,e,t){this.stores.toolStore.tool=new ue(this,o,e,t)}startRichTextVariableEditTool(o,e,t){this.stores.toolStore.tool=new ye(this,o,e,t)}startStringVariableEditTool(o,e,t){this.stores.toolStore.tool=new Be(this,o,e,t)}startMoveTool(o,e,t){this.stores.toolStore.tool=new fe(this,o,e,t)}exitTool(){this.startHighlightTool()}onChangeRoute(){this.stores.editableNodeHighlightStore.onChangeRoute(),this.exitTool()}getStateToken(){return this.stores.undoRedoManager.getUndoBufferSize()}undo(){let{undoRedoManager:o,toolStore:e,projectStore:t}=this.stores;e.tool?.undo?e.tool.undo():o.peekUndo()&&(o.undo(this.tree),t.commitTreeAndSend(!1))}redo(){let{undoRedoManager:o,toolStore:e,projectStore:t}=this.stores;e.tool?.redo?e.tool.redo():o.peekRedo()&&(o.redo(this.tree),t.commitTreeAndSend(!1))}beginUndoGroup(){this.stores.undoRedoManager.beginUndoGroup()}endUndoGroup(){this.stores.undoRedoManager.scheduleEndUndoGroup()}};var bt=y(w(),1);Ri({enableFontStore:!0,fetchGoogleFontsList:Ys,fetchFontshareFontsList:Gs,fetchBuiltInFontsList:Ks});async function KS(r,o){let e=new Zr(o);await e.stores.accessStore.set(r),e.stores.sandboxStore.loadSandbox(),Ds(e.stores.assetStore.assetMap),ut.importFramerFonts(ea),Us(),Object.assign(window,{engine:e}),qs((0,bt.jsx)(ia.Provider,{value:e,children:(0,bt.jsx)(dl,{forceDarkMode:!0,children:(0,bt.jsx)(za,{mode:"onPageEditing",children:(0,bt.jsxs)(td,{children:[(0,bt.jsx)(yf,{}),(0,bt.jsx)(Uf,{})]})})})}),document.getElementById("root"))}export{KS as renderEditorBar};
//# sourceMappingURL=https://app.framerstatic.com/render-GXKFHWSQ.mjs.map
